<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Rights Alert System - Track Legislation, Protect Your Rights</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --liberty-blue: #1e3a8a;
            --liberty-blue-light: #3b82f6;
            --liberty-blue-dark: #0f172a;
            --freedom-red: #dc2626;
            --freedom-red-light: #fca5a5;
            --justice-gold: #fbbf24;
            --alert-urgent: #ef4444;
            --alert-warning: #f59e0b;
            --alert-success: #10b981;
            --neutral-50: #f8fafc;
            --neutral-100: #f1f5f9;
            --neutral-200: #e2e8f0;
            --neutral-300: #cbd5e1;
            --neutral-700: #334155;
            --neutral-800: #1e293b;
            --neutral-900: #0f172a;
        }
        
        body { 
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f1f5f9;
            min-height: 100vh;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .heading-display {
            font-family: 'Crimson Pro', Georgia, serif;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        .heading-primary {
            font-family: 'Work Sans', sans-serif;
            font-weight: 700;
            letter-spacing: -0.01em;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .animate-fade-in { animation: fadeInUp 0.6s ease-out forwards; }
        .animate-slide-in { animation: slideInRight 0.5s ease-out forwards; }
        .animate-pulse { animation: pulse 2s ease-in-out infinite; }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Work Sans', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9375rem;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px -4px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active { transform: translateY(0); }
        
        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #1e3a8a;
            border: 2px solid #1e3a8a;
        }
        
        .btn-danger { background: #dc2626; color: white; }
        .btn-success { background: #10b981; color: white; }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .badge-high {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .badge-medium {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        .badge-low {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e3a8a;
            border: 1px solid #93c5fd;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-2px);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            animation: fadeIn 0.2s ease-out;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        .impact-high {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 50%, #fca5a5 100%);
            border-left: 4px solid #dc2626;
        }
        
        .impact-medium {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fcd34d 100%);
            border-left: 4px solid #f59e0b;
        }
        
        .impact-low {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #93c5fd 100%);
            border-left: 4px solid #3b82f6;
        }
        
        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #1e3a8a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        /* Simplified scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Sidebar drawer */
        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.5);
            z-index: 200;
            animation: fadeIn 0.2s ease-out;
        }
        
        .sidebar-drawer {
            position: fixed;
            top: 0; right: 0; bottom: 0;
            width: 320px;
            max-width: 85vw;
            background: white;
            z-index: 201;
            overflow-y: auto;
            box-shadow: -8px 0 30px rgba(0,0,0,0.15);
            animation: slideFromRight 0.3s ease-out;
            padding: 2rem 1.5rem;
        }
        
        @keyframes slideFromRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .desktop-only { display: none !important; }
            .mobile-stack { flex-direction: column !important; }
        }
        @media (min-width: 769px) {
            .mobile-only { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        const formatDate = (dateStr) => {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        };
        
        const stripHtml = (html) => {
            if (!html) return '';
            let text = html
                .replace(/<\/p>/gi, ' ')
                .replace(/<p>/gi, ' ')
                .replace(/<br\s*\/?>/gi, ' ')
                .replace(/<\/div>/gi, ' ')
                .replace(/<div>/gi, ' ');
            const tmp = document.createElement('div');
            tmp.innerHTML = text;
            return (tmp.textContent || tmp.innerText || '').replace(/\s+/g, ' ').trim();
        };
        
        const calculateDaysUntil = (dateStr) => {
            if (!dateStr) return null;
            const target = new Date(dateStr);
            const now = new Date();
            const diffTime = target - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        };

        // ============================================
// CITY PORTALS REGISTRY (AZ cities + portals)
// ============================================
// Fixes:
// - prevents Phoenix/Mesa/Apache Junction collisions
// - supports non-Legistar portals (CivicClerk, Granicus, OnBase, city pages)
//
// Convention:
// - If system === 'legistar' => meeting calendar is `${base}/Calendar.aspx`
// - Otherwise => open `base` as-is
const AZ_CITY_PORTALS = {
    "Apache Junction, AZ": { system: "legistar", base: "https://apachejunction.legistar.com" },
    "Avondale, AZ": { system: "civicclerk", base: "https://avondaleaz.portal.civicclerk.com/" },
    "Benson, AZ": { system: "citysite", base: "https://www.bensonaz.gov/government/city_council/agendas_minutes___public_notices.php" },
    "Bisbee, AZ": { system: "citysite", base: "https://www.bisbeeaz.gov/66/Agendas-Minutes" },
    "Camp Verde, AZ": { system: "citysite", base: "https://www.campverde.az.gov/government/town_council/agendas_minutes.php" },
    "Coolidge, AZ": { system: "citysite", base: "https://www.coolidgeaz.com/index.asp?SEC=D192363A-7D8F-4DB2-ABE7-68D2F6DE3894" },
    "Cottonwood, AZ": { system: "citysite", base: "https://cottonwoodaz.gov/129/Agendas-Minutes" },
    "Douglas, AZ": { system: "citysite", base: "https://www.douglasaz.gov/AgendaCenter" },
    "Eloy, AZ": { system: "granicus", base: "https://eloyaz.gov/574/Agendas-Minutes-Public-Notices" },
    "Flagstaff, AZ": { system: "destinyhosted", base: "https://www.flagstaff.az.gov/991/Agendas-Minutes" },
    "Glendale, AZ": { system: "legistar", base: "https://glendale-az.legistar.com" },
    "Goodyear, AZ": { system: "legistar", base: "https://goodyear.legistar.com" },
    "Kingman, AZ": { system: "citysite", base: "https://www.cityofkingman.gov/government/agendas-minutes" },
    "Lake Havasu City, AZ": { system: "legistar", base: "https://lakehavasucity.legistar.com" },
    "Maricopa, AZ": { system: "legistar", base: "https://maricopa.legistar.com" },
    "Mesa, AZ": { system: "legistar", base: "https://mesa.legistar.com" },
    "Peoria, AZ": { system: "citysite", base: "https://www.peoriaaz.gov/residents/public-meetings/city-council-meetings" },
    "Phoenix, AZ": { system: "legistar", base: "https://phoenix.legistar.com" },
    "Prescott, AZ": { system: "civicclerk", base: "https://prescottaz.portal.civicclerk.com/" },
    "Safford, AZ": { system: "citysite", base: "https://www.cityofsafford.us/AgendaCenter" },
    "San Luis, AZ": { system: "citysite", base: "https://www.sanluisaz.gov/AgendaCenter" },
    "Scottsdale, AZ": { system: "granicus", base: "https://ww2.scottsdaleaz.gov/council/meeting-information/agendas-minutes" },
    "Sedona, AZ": { system: "citysite", base: "https://www.sedonaaz.gov/your-government/meetings-documents" },
    "Show Low, AZ": { system: "citysite", base: "https://www.showlowaz.gov/o/cosl/page/open-meeting-law-information" },
    "Surprise, AZ": { system: "civicclerk", base: "https://surpriseaz.portal.civicclerk.com/" },
    "Tempe, AZ": { system: "onbase", base: "https://tempe.hylandcloud.com/AgendaOnline" },
    "Tolleson, AZ": { system: "civicclerk", base: "https://tollesonaz.portal.civicclerk.com/" },
    "Tombstone, AZ": { system: "citysite", base: "https://cityoftombstoneaz.gov/agendas-minutes/" },
    "Tucson, AZ": { system: "citysite", base: "https://www.tucsonaz.gov/Government/Mayor-Council-and-City-Manager/Meeting-Schedules-Agendas" },
    "Willcox, AZ": { system: "citysite", base: "https://willcox.az.gov/city-council-agendas-minutes-archive" },
    "Williams, AZ": { system: "citysite", base: "https://www.williamsaz.gov/government/meetings/city_council" },
    "Winslow, AZ": { system: "citysite", base: "https://www.winslowaz.gov/page/boards-agendas-minutes" },
    "Yuma, AZ": { system: "legistar", base: "https://yuma-az.legistar.com" }
};

const getCityPortalEntry = (cityLabel) => AZ_CITY_PORTALS[cityLabel] || null;

const getCityPortalUrl = (cityLabel) => {
    const entry = getCityPortalEntry(cityLabel);
    return entry ? entry.base : '';
};

const getCityCalendarUrl = (cityLabel) => {
    const entry = getCityPortalEntry(cityLabel);
    if (!entry) return '';
    if (entry.system === 'legistar') return `${entry.base}/Calendar.aspx`;
    return entry.base;
};

// Back-compat: some parts of the app expect a "portal base".
const getPortalBaseForCity = (cityName) => getCityPortalUrl(cityName);




        // ============================================
        // MODULE 1: SUBSCRIPTION SYSTEM
        // ============================================
        
        function SubscriptionModal({ isOpen, onClose }) {
            const [email, setEmail] = useState('');
            const [phone, setPhone] = useState('');
            const [preferences, setPreferences] = useState({
                billsIntroduced: true, billsPassed: true, watchlistUpdates: true,
                urgentVotes: true, highImpact: true, mediumImpact: false,
                lowImpact: false, weeklyDigest: true
            });
            const [subscribed, setSubscribed] = useState(false);
            
            const handleSubscribe = () => {
                console.log('Subscribing:', { email, phone, preferences });
                setSubscribed(true);
                setTimeout(() => { onClose(); setSubscribed(false); }, 2000);
            };
            
            if (!isOpen) return null;
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{ maxWidth: '600px' }}>
                        {subscribed ? (
                            <div style={{ textAlign: 'center', padding: '2rem' }}>
                                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>‚úÖ</div>
                                <h2 className="heading-primary" style={{ fontSize: '1.75rem', marginBottom: '0.5rem', color: '#10b981' }}>You're Subscribed!</h2>
                                <p style={{ color: '#334155' }}>We'll keep you informed about legislation that matters to you.</p>
                            </div>
                        ) : (
                            <>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                    <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üìß Stay Informed</h2>
                                    <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: '#334155' }}>‚úï</button>
                                </div>
                                <p style={{ marginBottom: '1.5rem', color: '#334155' }}>Get real-time alerts when legislation threatens your rights.</p>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', marginBottom: '1.5rem' }}>
                                    <div>
                                        <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem', color: '#1e293b' }}>Email Address *</label>
                                        <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="your.email@example.com" style={{ width: '100%', padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem' }} />
                                    </div>
                                    <div>
                                        <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem', color: '#1e293b' }}>Phone Number (Optional)</label>
                                        <input type="tel" value={phone} onChange={e => setPhone(e.target.value)} placeholder="(555) 123-4567" style={{ width: '100%', padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem' }} />
                                        <p style={{ fontSize: '0.875rem', color: '#334155', marginTop: '0.25rem' }}>For urgent SMS alerts only</p>
                                    </div>
                                </div>
                                <div style={{ backgroundColor: '#f1f5f9', padding: '1.5rem', borderRadius: '0.75rem', marginBottom: '1.5rem' }}>
                                    <h3 style={{ fontWeight: 600, marginBottom: '1rem', color: '#1e293b' }}>Alert Preferences</h3>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                        {[
                                            { key: 'billsIntroduced', label: 'üìù Bills Introduced', desc: 'New bills matching your topics' },
                                            { key: 'billsPassed', label: '‚úÖ Bills Passed', desc: 'Bills that become law' },
                                            { key: 'watchlistUpdates', label: '‚≠ê Watchlist Updates', desc: 'Your watchlisted bills change status' },
                                            { key: 'urgentVotes', label: 'üö® Urgent Votes', desc: 'Votes happening within 7 days' },
                                            { key: 'highImpact', label: 'üî¥ High Impact', desc: 'Critical legislation' },
                                            { key: 'weeklyDigest', label: 'üì¨ Weekly Digest', desc: 'Sunday summary' }
                                        ].map(pref => (
                                            <label key={pref.key} style={{ display: 'flex', alignItems: 'flex-start', cursor: 'pointer', padding: '0.5rem', borderRadius: '0.5rem', background: preferences[pref.key] ? 'rgba(59, 130, 246, 0.1)' : 'transparent' }}>
                                                <input type="checkbox" checked={preferences[pref.key]} onChange={e => setPreferences({ ...preferences, [pref.key]: e.target.checked })} style={{ marginRight: '0.75rem', marginTop: '0.25rem', width: '18px', height: '18px', cursor: 'pointer' }} />
                                                <div>
                                                    <div style={{ fontWeight: 600, color: '#1e293b' }}>{pref.label}</div>
                                                    <div style={{ fontSize: '0.875rem', color: '#334155' }}>{pref.desc}</div>
                                                </div>
                                            </label>
                                        ))}
                                    </div>
                                </div>
                                <button onClick={handleSubscribe} disabled={!email} className="btn btn-primary" style={{ width: '100%', fontSize: '1.1rem', padding: '1rem', justifyContent: 'center' }}>üìß Subscribe to Alerts</button>
                                <p style={{ fontSize: '0.875rem', color: '#334155', textAlign: 'center', marginTop: '1rem' }}>We respect your privacy. Unsubscribe anytime.</p>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // ============================================
        // MODULE 2: IMPACT EXPLAINER
        // ============================================
        
        function ImpactExplainerModal({ isOpen, onClose, impactLevel, billTitle, howItAffectsYou }) {
            if (!isOpen) return null;
            const explanations = {
                high: { icon: 'üö®', title: 'HIGH IMPACT', color: '#dc2626', bgColor: '#fee2e2', criteria: ['Directly affects constitutional rights or fundamental freedoms','Impacts majority of citizens immediately','Changes core government programs (healthcare, taxes, social security)','Alters voting rights, gun rights, or privacy protections','Close to passing or already passed one chamber'], examples: ['Bills requiring ID verification for social media accounts','Changes to healthcare coverage or Medicare/Medicaid','Tax law changes affecting most taxpayers','Encryption backdoor requirements','Voting rights modifications'], urgency: 'These bills require immediate attention and action from citizens.' },
                medium: { icon: '‚ö†Ô∏è', title: 'MEDIUM IMPACT', color: '#f59e0b', bgColor: '#fef3c7', criteria: ['Affects specific groups or regions significantly','Important but not immediately critical','Changes to education, veteran benefits, or energy policy','Labor laws, environmental regulations, or housing policy','In committee or early legislative stages'], examples: ['Student loan forgiveness programs','Veteran healthcare expansion','Clean energy incentives','Minimum wage adjustments','Housing assistance programs'], urgency: 'Monitor these bills and take action if they affect you or your community.' },
                low: { icon: '‚ÑπÔ∏è', title: 'LOW IMPACT', color: '#1e3a8a', bgColor: '#dbeafe', criteria: ['Narrow scope or affects small populations','Technical or administrative changes','Commemorative bills or resolutions','Early introduction with low passage probability','Primarily procedural or organizational'], examples: ['Renaming federal buildings','Commemorative coin authorizations','Small grant programs','Technical corrections to existing law','Congressional internal procedures'], urgency: "Stay informed but these generally don't require immediate action." }
            };
            const info = explanations[impactLevel] || explanations.low;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: info.color }}>{info.icon} Why is this {info.title}?</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <div style={{ backgroundColor: info.bgColor, padding: '1rem', borderRadius: '0.75rem', marginBottom: '1.5rem', borderLeft: `4px solid ${info.color}` }}>
                            <p style={{ fontWeight: 600, fontSize: '1.1rem', color: '#1e293b' }}>"{billTitle}"</p>
                        </div>
                        {howItAffectsYou && (
                            <div style={{ marginBottom: '1.5rem', backgroundColor: '#fef2f2', border: '2px solid #fecaca', borderRadius: '0.75rem', padding: '1.25rem' }}>
                                <h3 style={{ fontWeight: 700, marginBottom: '0.75rem', color: '#991b1b', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><span>‚ö†Ô∏è</span> Why THIS Bill is {info.title}</h3>
                                <p style={{ color: '#1e293b', lineHeight: '1.7', margin: 0 }}>{howItAffectsYou}</p>
                            </div>
                        )}
                        <div style={{ marginBottom: '1.5rem' }}>
                            <h3 style={{ fontWeight: 700, marginBottom: '0.75rem', color: '#1e293b' }}>Classification Criteria</h3>
                            <ul style={{ listStyle: 'none', paddingLeft: 0 }}>
                                {info.criteria.map((c, i) => (<li key={i} style={{ padding: '0.5rem 0', display: 'flex', alignItems: 'flex-start' }}><span style={{ color: info.color, marginRight: '0.5rem', fontSize: '1.2rem' }}>‚úì</span><span style={{ color: '#334155' }}>{c}</span></li>))}
                            </ul>
                        </div>
                        <div style={{ backgroundColor: info.bgColor, padding: '1rem', borderRadius: '0.75rem' }}>
                            <p style={{ fontWeight: 600, color: '#1e293b' }}>{info.urgency}</p>
                        </div>
                        <button onClick={onClose} className="btn btn-secondary" style={{ marginTop: '1.5rem', width: '100%', justifyContent: 'center' }}>Got it, thanks!</button>
                    </div>
                </div>
            );
        }

        // ============================================
        // MODULE 3: STATUS LABELS
        // ============================================
        
        const BillTitle = ({ bill }) => {
            const match = bill.title.match(/^([A-Z]+\.?\s*\d+)\s*-\s*(.+)$/);
            if (match) {
                return (
                    <h3 style={{ fontWeight: 700, fontSize: '1.15rem', marginBottom: '0.5rem', color: '#0f172a' }}>
                        <a href={bill.url} target="_blank" rel="noopener noreferrer" style={{ color: '#1e3a8a', textDecoration: 'underline', cursor: 'pointer' }} onClick={(e) => e.stopPropagation()}>{match[1]}</a>
                        {' - '}{match[2]}
                    </h3>
                );
            }
            return <h3 style={{ fontWeight: 700, fontSize: '1.15rem', marginBottom: '0.5rem', color: '#0f172a' }}>{bill.title}</h3>;
        };
        
        function StatusBadge({ status, statusDisplay, statusPriority }) {
            const getStatusStyle = () => {
                if (statusPriority >= 10) return { bg: '#dcfce7', color: '#166534', border: '#86efac', icon: '‚úÖ' };
                if (statusPriority === 9) return { bg: '#fee2e2', color: '#991b1b', border: '#fca5a5', icon: 'üö®' };
                if (statusPriority === 8) return { bg: '#fed7aa', color: '#9a3412', border: '#fdba74', icon: 'üö®' };
                if (statusPriority === 7) return { bg: '#fef3c7', color: '#92400e', border: '#fde68a', icon: '‚ö†Ô∏è' };
                if (statusPriority >= 5) return { bg: '#dbeafe', color: '#1e3a8a', border: '#93c5fd', icon: 'üìã' };
                if (statusPriority >= 3) return { bg: '#e0e7ff', color: '#3730a3', border: '#c7d2fe', icon: 'üìÑ' };
                return { bg: '#f3f4f6', color: '#374151', border: '#d1d5db', icon: 'üìÑ' };
            };
            const style = getStatusStyle();
            return (
                <div style={{ display: 'inline-flex', alignItems: 'center', gap: '0.5rem', padding: '0.375rem 0.75rem', backgroundColor: style.bg, color: style.color, borderRadius: '0.5rem', border: `2px solid ${style.border}`, fontWeight: 600, fontSize: '0.8125rem' }}>
                    <span>{style.icon}</span><span>{statusDisplay}</span>
                </div>
            );
        }

        // ============================================
        // MODULE 6: COUNTDOWN TIMER
        // ============================================
        
        function CountdownTimer({ voteDate, billNumber }) {
            const [timeLeft, setTimeLeft] = useState('');
            useEffect(() => {
                if (!voteDate) return;
                const updateTimer = () => {
                    const daysLeft = calculateDaysUntil(voteDate);
                    if (daysLeft < 0) setTimeLeft('Vote completed');
                    else if (daysLeft === 0) setTimeLeft('VOTE TODAY!');
                    else if (daysLeft === 1) setTimeLeft('VOTE TOMORROW!');
                    else if (daysLeft <= 7) setTimeLeft(`VOTE IN ${daysLeft} DAYS`);
                    else setTimeLeft(`Vote in ${daysLeft} days`);
                };
                updateTimer();
                const interval = setInterval(updateTimer, 60000);
                return () => clearInterval(interval);
            }, [voteDate]);
            if (!voteDate || calculateDaysUntil(voteDate) > 14) return null;
            const daysLeft = calculateDaysUntil(voteDate);
            const isUrgent = daysLeft <= 3 && daysLeft >= 0;
            return (
                <div style={{ backgroundColor: isUrgent ? '#fee2e2' : '#fef3c7', border: `2px solid ${isUrgent ? '#fca5a5' : '#fde68a'}`, borderRadius: '0.75rem', padding: '0.75rem 1rem', marginTop: '0.75rem', display: 'flex', alignItems: 'center', gap: '0.75rem', animation: isUrgent ? 'pulse 2s ease-in-out infinite' : 'none' }}>
                    <div style={{ fontSize: '1.5rem' }}>‚è∞</div>
                    <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 700, color: isUrgent ? '#991b1b' : '#92400e', fontSize: '1rem' }}>{timeLeft}</div>
                        <div style={{ fontSize: '0.8125rem', color: '#334155' }}>Expected vote: {formatDate(voteDate)}</div>
                    </div>
                </div>
            );
        }

        // ============================================
        // MODULE 7: REPRESENTATIVES
        // ============================================
        
        function RepresentativesModal({ isOpen, onClose, zipCode }) {
            const [loading, setLoading] = useState(false);
            const [representatives, setRepresentatives] = useState(null);
            const [inputZip, setInputZip] = useState(zipCode || '');
            
            const fetchRepresentatives = async (zip) => {
                setLoading(true);
                setTimeout(() => {
                    setRepresentatives({
                        senators: [
                            { name: 'Sen. Jane Smith', party: 'Democrat', state: 'AZ', phone: '(202) 224-1234', email: 'jane.smith@senate.gov', twitter: '@SenJaneSmith', office: '123 Senate Building, Washington, DC 20510', grade: 'A+', alignment: 92, votingRecord: { total: 847, proRights: 780, antiRights: 45, absent: 22 } },
                            { name: 'Sen. John Doe', party: 'Republican', state: 'AZ', phone: '(202) 224-5678', email: 'john.doe@senate.gov', twitter: '@SenJohnDoe', office: '456 Senate Building, Washington, DC 20510', grade: 'B', alignment: 68, votingRecord: { total: 847, proRights: 576, antiRights: 201, absent: 70 } }
                        ],
                        representative: { name: 'Rep. Maria Garcia', party: 'Democrat', district: 'AZ-7', phone: '(202) 225-9876', email: 'maria.garcia@house.gov', twitter: '@RepMariaGarcia', office: '789 Cannon Building, Washington, DC 20515', grade: 'A', alignment: 88, votingRecord: { total: 1243, proRights: 1094, antiRights: 98, absent: 51 } }
                    });
                    setLoading(false);
                }, 1000);
            };
            
            useEffect(() => { if (isOpen && inputZip && inputZip.length === 5) fetchRepresentatives(inputZip); }, [isOpen, inputZip]);
            if (!isOpen) return null;
            
            const RepCard = ({ rep, type }) => {
                const gradeColor = rep.grade.startsWith('A') ? '#10b981' : rep.grade.startsWith('B') ? '#3b82f6' : '#f59e0b';
                return (
                    <div className="card" style={{ marginBottom: '1rem' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem' }}>
                            <div>
                                <h3 style={{ fontWeight: 700, color: '#1e3a8a', marginBottom: '0.25rem' }}>{rep.name}</h3>
                                <div style={{ fontSize: '0.875rem', color: '#334155' }}>{rep.party} ‚Ä¢ {type === 'senator' ? rep.state : rep.district}</div>
                            </div>
                            <div style={{ textAlign: 'center' }}>
                                <div style={{ width: '50px', height: '50px', borderRadius: '50%', backgroundColor: gradeColor, color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 700, fontSize: '1.25rem' }}>{rep.grade}</div>
                                <div style={{ fontSize: '0.6875rem', color: '#334155', marginTop: '0.25rem' }}>Score</div>
                            </div>
                        </div>
                        <div style={{ backgroundColor: '#f1f5f9', padding: '0.75rem', borderRadius: '0.5rem', marginBottom: '0.75rem' }}>
                            <div style={{ display: 'flex', gap: '1rem', fontSize: '0.8125rem' }}>
                                <div><span style={{ color: '#10b981', fontWeight: 600 }}>{rep.votingRecord.proRights}</span> Pro</div>
                                <div><span style={{ color: '#ef4444', fontWeight: 600 }}>{rep.votingRecord.antiRights}</span> Anti</div>
                                <div><span style={{ color: '#334155', fontWeight: 600 }}>{rep.votingRecord.absent}</span> Absent</div>
                            </div>
                            <div style={{ marginTop: '0.5rem' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                    <div style={{ flex: 1, height: '6px', backgroundColor: '#e5e7eb', borderRadius: '9999px', overflow: 'hidden' }}>
                                        <div style={{ width: `${rep.alignment}%`, height: '100%', backgroundColor: gradeColor, transition: 'width 1s ease' }}></div>
                                    </div>
                                    <span style={{ fontSize: '0.8125rem', fontWeight: 600, color: gradeColor }}>{rep.alignment}%</span>
                                </div>
                            </div>
                        </div>
                        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                            <button className="btn btn-primary" style={{ flex: 1, fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>üìß Email</button>
                            <button className="btn btn-secondary" style={{ flex: 1, fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>üìû Call</button>
                        </div>
                    </div>
                );
            };
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üèõÔ∏è Your Representatives</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <div style={{ marginBottom: '1.5rem' }}>
                            <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem' }}>Enter Your ZIP Code</label>
                            <input type="text" value={inputZip} onChange={e => setInputZip(e.target.value)} placeholder="85001" maxLength="5" style={{ width: '100%', padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem' }} />
                        </div>
                        {loading ? (
                            <div style={{ display: 'flex', justifyContent: 'center', padding: '3rem' }}><div className="spinner"></div></div>
                        ) : representatives ? (
                            <>
                                <h3 style={{ fontWeight: 700, marginBottom: '1rem', color: '#1e293b' }}>U.S. Senators</h3>
                                {representatives.senators.map((sen, i) => <RepCard key={i} rep={sen} type="senator" />)}
                                <h3 style={{ fontWeight: 700, marginBottom: '1rem', marginTop: '1.5rem', color: '#1e293b' }}>U.S. Representative</h3>
                                <RepCard rep={representatives.representative} type="representative" />
                            </>
                        ) : (
                            <div style={{ textAlign: 'center', padding: '3rem', color: '#334155' }}>Enter a ZIP code to see your representatives</div>
                        )}
                    </div>
                </div>
            );
        }

        // ============================================
        // MODULE 9: BEFORE VS AFTER
        // ============================================
        
        function BeforeAfterComparison({ bill }) {
            const generateComparison = () => {
                const titleLower = bill.title.toLowerCase();
                if (titleLower.includes('social media') || titleLower.includes('digital identity')) {
                    return { before: { title: 'Current Law', points: ['Anyone can create social media accounts anonymously','No government ID required for online services','Privacy protected by existing laws','Platforms self-regulate age verification'] }, after: { title: 'Proposed Changes', points: ['Government-issued ID required for all social media accounts','Biometric verification mandatory','All users must verify real identity','Platforms must store and verify ID documents'] }, impact: 'Fundamentally changes online privacy, requiring government verification for speech platforms.' };
                }
                if (titleLower.includes('encryption') || titleLower.includes('backdoor')) {
                    return { before: { title: 'Current Law', points: ['End-to-end encryption is legal and widely used','Companies can offer secure messaging','Law enforcement needs warrants for access','No requirement to build vulnerabilities'] }, after: { title: 'Proposed Changes', points: ['All encrypted services must include government backdoor','Tech companies required to provide master keys','Law enforcement can access encrypted data without notice','Mandatory "lawful access" encryption'] }, impact: 'Creates security vulnerabilities exploitable by bad actors, not just law enforcement.' };
                }
                return { before: { title: 'Current Law', points: ['Existing regulations and protections in place','Current balance of rights and restrictions','Established legal precedents'] }, after: { title: 'Proposed Changes', points: ['New requirements or restrictions','Modified rights or obligations','Changed enforcement mechanisms'] }, impact: 'Review the full bill text to understand all changes.' };
            };
            const comparison = generateComparison();
            return (
                <div style={{ marginTop: '1.5rem' }}>
                    <h3 style={{ fontWeight: 700, marginBottom: '1rem', color: '#1e293b' }}>‚öñÔ∏è Before vs. After</h3>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1rem' }}>
                        <div style={{ backgroundColor: '#dcfce7', border: '2px solid #86efac', borderRadius: '0.75rem', padding: '1rem' }}>
                            <h4 style={{ fontWeight: 700, color: '#166534', marginBottom: '0.75rem' }}>{comparison.before.title}</h4>
                            <ul style={{ listStyle: 'none', paddingLeft: 0, fontSize: '0.875rem' }}>
                                {comparison.before.points.map((p, i) => (<li key={i} style={{ padding: '0.5rem 0', color: '#334155', display: 'flex' }}><span style={{ color: '#10b981', marginRight: '0.5rem' }}>‚úì</span><span>{p}</span></li>))}
                            </ul>
                        </div>
                        <div style={{ backgroundColor: '#fee2e2', border: '2px solid #fca5a5', borderRadius: '0.75rem', padding: '1rem' }}>
                            <h4 style={{ fontWeight: 700, color: '#991b1b', marginBottom: '0.75rem' }}>{comparison.after.title}</h4>
                            <ul style={{ listStyle: 'none', paddingLeft: 0, fontSize: '0.875rem' }}>
                                {comparison.after.points.map((p, i) => (<li key={i} style={{ padding: '0.5rem 0', color: '#334155', display: 'flex' }}><span style={{ color: '#ef4444', marginRight: '0.5rem' }}>‚Üí</span><span>{p}</span></li>))}
                            </ul>
                        </div>
                    </div>
                    <div style={{ backgroundColor: '#fef3c7', border: '2px solid #fde68a', borderRadius: '0.75rem', padding: '1rem' }}>
                        <p style={{ fontSize: '0.875rem', color: '#1e293b', fontWeight: 600 }}><strong>Key Impact:</strong> {comparison.impact}</p>
                    </div>
                </div>
            );
        }

        // ============================================
        // MODULE 10: SUPPORT/OPPOSE
        // ============================================
        
        function SupportOppose({ bill }) {
            const generatePositions = () => {
                const titleLower = bill.title.toLowerCase();
                if (titleLower.includes('social media') || titleLower.includes('digital identity')) {
                    return { support: [{ name: 'National Center for Missing & Exploited Children', reason: 'Believes it will protect children from predators' },{ name: 'Some Law Enforcement Groups', reason: 'Easier to track criminal activity online' }], oppose: [{ name: 'Electronic Frontier Foundation (EFF)', reason: 'Massive privacy violation and surveillance threat' },{ name: 'ACLU', reason: 'Chills free speech and targets vulnerable groups' },{ name: 'Fight for the Future', reason: "Creates dangerous database of citizens' identities" }] };
                }
                if (titleLower.includes('encryption') || titleLower.includes('backdoor')) {
                    return { support: [{ name: 'FBI and DOJ', reason: "Claims it's needed to prevent terrorism" }], oppose: [{ name: 'EFF', reason: 'Backdoors make everyone less secure' },{ name: 'Apple, Google, Meta', reason: 'Cannot build secure systems with intentional vulnerabilities' },{ name: 'Cybersecurity Experts', reason: 'Backdoors exploited by hackers and foreign actors' }] };
                }
                return { support: [{ name: 'Bill Sponsors', reason: 'Introduced the legislation' }], oppose: [{ name: 'Opposition TBD', reason: 'Review full bill for opposing organizations' }] };
            };
            const positions = generatePositions();
            return (
                <div style={{ marginTop: '1.5rem' }}>
                    <h3 style={{ fontWeight: 700, marginBottom: '1rem', color: '#1e293b' }}>ü§ù Who Supports & Opposes</h3>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                        <div>
                            <h4 style={{ fontWeight: 700, color: '#166534', marginBottom: '0.75rem' }}>üëç Supporting</h4>
                            {positions.support.map((org, i) => (<div key={i} className="card" style={{ marginBottom: '0.75rem', padding: '1rem' }}><div style={{ fontWeight: 600, color: '#1e293b', marginBottom: '0.25rem' }}>{org.name}</div><div style={{ fontSize: '0.875rem', color: '#334155' }}>{org.reason}</div></div>))}
                        </div>
                        <div>
                            <h4 style={{ fontWeight: 700, color: '#991b1b', marginBottom: '0.75rem' }}>üëé Opposing</h4>
                            {positions.oppose.map((org, i) => (<div key={i} className="card" style={{ marginBottom: '0.75rem', padding: '1rem' }}><div style={{ fontWeight: 600, color: '#1e293b', marginBottom: '0.25rem' }}>{org.name}</div><div style={{ fontSize: '0.875rem', color: '#334155' }}>{org.reason}</div></div>))}
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================
        // MODULE 11: SHARE STORY
        // ============================================
        
        function ShareStoryModal({ isOpen, onClose, billId, billTitle }) {
            const [story, setStory] = useState('');
            const [name, setName] = useState('');
            const [location, setLocation] = useState('');
            const [submitted, setSubmitted] = useState(false);
            const handleSubmit = () => {
                if (!story || !name) return;
                localStorage.setItem(`user_story_${billId}`, JSON.stringify({ name, location, story, billId, billTitle, date: new Date().toISOString() }));
                setSubmitted(true);
                setTimeout(() => { setStory(''); setName(''); setLocation(''); setSubmitted(false); }, 3000);
            };
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üì¢ Share Your Story</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <p style={{ marginBottom: '1.5rem', color: '#334155' }}>Tell lawmakers how this bill would affect your life.</p>
                        {submitted ? (
                            <div style={{ textAlign: 'center', padding: '2rem', backgroundColor: '#dcfce7', borderRadius: '0.75rem' }}><div style={{ fontSize: '3rem', marginBottom: '0.5rem' }}>‚úÖ</div><h3 style={{ fontWeight: 700, color: '#166534' }}>Story Saved!</h3></div>
                        ) : (
                            <div style={{ marginBottom: '1.5rem' }}>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem' }}>Your Name</label>
                                    <input type="text" value={name} onChange={e => setName(e.target.value)} placeholder="John D." style={{ width: '100%', padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem' }} />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem' }}>How will this bill affect you?</label>
                                    <textarea value={story} onChange={e => setStory(e.target.value)} placeholder="Share your concerns..." rows="5" style={{ width: '100%', padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem', fontFamily: 'inherit', resize: 'vertical' }} />
                                </div>
                                <button onClick={handleSubmit} disabled={!story || !name} className="btn btn-primary" style={{ width: '100%', justifyContent: 'center' }}>üíæ Save My Story</button>
                            </div>
                        )}
                        <div style={{ backgroundColor: '#fef3c7', padding: '1rem', borderRadius: '0.5rem', border: '2px solid #fde68a' }}>
                            <p style={{ fontSize: '0.875rem', color: '#92400e', margin: 0, fontWeight: 600, marginBottom: '0.25rem' }}>‚ö†Ô∏è How This Works:</p>
                            <p style={{ fontSize: '0.8125rem', color: '#78350f', margin: 0 }}>Your story is saved locally on this device only. It is NOT automatically sent to politicians. Copy and send using the email template in "Take Action."</p>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================
        // SUPPORT REPEAL MODAL
        // ============================================
        
        function SupportRepealModal({ isOpen, onClose, lawName, repealBills }) {
            const [email, setEmail] = useState('');
            const [step, setStep] = useState(1);
            const handleSupport = () => { setStep(2); };
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        {step === 1 ? (
                            <>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                    <h2 className="heading-primary" style={{ fontSize: '1.5rem', color: '#1e3a8a' }}>‚úä Support Repealing: {lawName}</h2>
                                    <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                                </div>
                                <p style={{ marginBottom: '1.5rem', color: '#334155' }}>Stay informed about repeal efforts.</p>
                                <div style={{ backgroundColor: '#eff6ff', padding: '1rem', borderRadius: '0.5rem', marginBottom: '1.5rem', border: '2px solid #93c5fd' }}>
                                    <p style={{ fontSize: '0.8125rem', color: '#1e293b', margin: 0 }}>üìß Your email is stored locally only. We provide scripts to contact YOUR representatives. We DO NOT share your email.</p>
                                </div>
                                <div style={{ marginBottom: '1.5rem' }}>
                                    <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem' }}>Email Address *</label>
                                    <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="your.email@example.com" style={{ width: '100%', padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem' }} />
                                </div>
                                <button onClick={handleSupport} disabled={!email} className="btn btn-primary" style={{ width: '100%', justifyContent: 'center' }}>‚úä Add My Support</button>
                            </>
                        ) : (
                            <div style={{ textAlign: 'center', padding: '2rem' }}>
                                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>‚úÖ</div>
                                <h2 style={{ fontSize: '1.5rem', color: '#10b981', marginBottom: '1rem' }}>Support Recorded!</h2>
                                <p style={{ color: '#334155', marginBottom: '1.5rem' }}>Your voice matters. Use the call/email templates to contact your representatives.</p>
                                <button onClick={onClose} className="btn btn-primary" style={{ justifyContent: 'center' }}>Close</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ============================================
        // LEARN MORE MODAL (Repeal Deep Dive)
        // ============================================
        
        function LearnMoreModal({ isOpen, onClose, law }) {
            if (!isOpen || !law) return null;
            const getContent = () => {
                if (law.name.includes('PATRIOT')) {
                    return { history: { passed: '2001', originalGoal: 'Counter terrorism after 9/11', actualEffect: 'Enabled mass surveillance of ordinary Americans' }, analysis: [{ source: 'EFF', summary: 'Section 215 allows bulk collection of phone and internet metadata', link: 'https://www.eff.org/nsa-spying' }], realWorldHarm: ['NSA collected billions of phone records of Americans with no connection to terrorism','Secret FISA court rubber-stamped nearly all requests'], repealEfforts: { currentBills: law.repealBills, timeline: 'Ongoing reform efforts since Snowden revelations in 2013' } };
                }
                return { history: { passed: law.passed, originalGoal: 'Review full history', actualEffect: law.issue }, analysis: [], realWorldHarm: [law.issue], repealEfforts: { currentBills: law.repealBills, timeline: 'Check Congress.gov for current status' } };
            };
            const content = getContent();
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{ maxWidth: '800px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üìö Deep Dive: {law.name}</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <div style={{ marginBottom: '1.5rem', backgroundColor: '#f1f5f9', padding: '1rem', borderRadius: '0.5rem' }}>
                            <div style={{ display: 'grid', gridTemplateColumns: '120px 1fr', gap: '0.5rem', fontSize: '0.875rem' }}>
                                <strong>Passed:</strong><span>{content.history.passed}</span>
                                <strong>Stated Goal:</strong><span>{content.history.originalGoal}</span>
                                <strong>Actual Effect:</strong><span style={{ color: '#dc2626', fontWeight: 600 }}>{content.history.actualEffect}</span>
                            </div>
                        </div>
                        <div style={{ marginBottom: '1.5rem', backgroundColor: '#fee2e2', padding: '1rem', borderRadius: '0.5rem', border: '2px solid #fca5a5' }}>
                            <h3 style={{ fontWeight: 700, marginBottom: '0.5rem', color: '#1e293b' }}>‚ö†Ô∏è Documented Harm</h3>
                            <ul style={{ margin: 0, paddingLeft: '1.25rem' }}>{content.realWorldHarm.map((h, i) => <li key={i} style={{ marginBottom: '0.5rem', color: '#334155' }}>{h}</li>)}</ul>
                        </div>
                        <div style={{ marginBottom: '1.5rem', backgroundColor: '#dcfce7', padding: '1rem', borderRadius: '0.5rem', border: '2px solid #86efac' }}>
                            <h3 style={{ fontWeight: 700, marginBottom: '0.5rem', color: '#166534' }}>üî• Active Repeal Bills</h3>
                            {content.repealEfforts.currentBills.map((b, i) => <div key={i} style={{ fontSize: '0.875rem', color: '#334155' }}>‚Ä¢ {b}</div>)}
                        </div>
                        <button onClick={onClose} className="btn btn-secondary" style={{ width: '100%', justifyContent: 'center' }}>Close</button>
                    </div>
                </div>
            );
        }

        // ============================================
        // DONATE MODAL
        // ============================================
        
        function DonateModal({ isOpen, onClose }) {
            const [amount, setAmount] = useState('25');
            const [customAmount, setCustomAmount] = useState('');
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{ maxWidth: '600px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üíô Support Our Mission</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <div style={{ backgroundColor: '#eff6ff', border: '2px solid #93c5fd', borderRadius: '0.75rem', padding: '1.5rem', marginBottom: '1.5rem' }}>
                            <p style={{ margin: 0, lineHeight: '1.6', color: '#334155' }}>The Civic Rights Alert System is independent, non-partisan, and funded by people like you. Your donation keeps this free for every American.</p>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '0.5rem', marginBottom: '1rem' }}>
                            {['5', '10', '25', '50'].map(amt => (
                                <button key={amt} onClick={() => { setAmount(amt); setCustomAmount(''); }} className="btn" style={{ backgroundColor: amount === amt ? '#1e3a8a' : 'white', color: amount === amt ? 'white' : '#1e3a8a', border: '2px solid #1e3a8a', padding: '0.75rem', fontSize: '1.1rem', fontWeight: 700 }}>${amt}</button>
                            ))}
                        </div>
                        <div style={{ textAlign: 'center', marginTop: '1.5rem' }}>
                            <button onClick={() => window.open('https://www.paypal.com/donate/?hosted_button_id=YOUR_PAYPAL_BUTTON_ID', '_blank')} style={{ backgroundColor: '#0070ba', color: 'white', border: 'none', padding: '1rem 2rem', borderRadius: '0.5rem', fontSize: '1.1rem', fontWeight: 700, cursor: 'pointer' }}>üí≥ Donate ${customAmount || amount} with PayPal</button>
                            <p style={{ fontSize: '0.75rem', color: '#334155', marginTop: '0.75rem' }}>Replace YOUR_PAYPAL_BUTTON_ID with your actual PayPal button ID</p>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================
        // STRATEGIC GUIDE MODAL
        // ============================================
        
        function StrategicGuideModal({ isOpen, onClose }) {
            if (!isOpen) return null;
            const stages = [
                { stage: 'Introduction', proMove: 'Kill the Momentum', description: 'Prevent co-sponsorships. Few sponsors = "dead on arrival."', tools: 'Congress.gov Cosponsors tab', icon: 'üìù' },
                { stage: 'Committee', proMove: 'Target the Chair', description: 'The Chair alone can refuse to schedule a hearing ("pigeonholing"), effectively killing the bill.', tools: 'House/Senate committee membership lists', icon: 'ü™ë' },
                { stage: 'Markup', proMove: 'Fiscal Arguments', description: 'If a bill costs too much, use CBO data to sway fiscal conservatives.', tools: 'CBO (Congressional Budget Office) reports', icon: 'üí∞' },
                { stage: 'Floor Debate', proMove: 'Poison Pill Amendments', description: "Urge friendly legislators to add controversial amendments so the bill's supporters vote against it.", tools: 'Legislative text tracking on LegiScan', icon: '‚ö†Ô∏è' },
                { stage: 'Final Vote', proMove: 'The "Hold" (Senate)', description: 'A single Senator can temporarily stop a bill from moving to the floor.', tools: 'Senate procedural rules', icon: '‚úã' }
            ];
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{ maxWidth: '800px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üéØ Strategic Guide</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <p style={{ fontSize: '0.875rem', color: '#334155', marginBottom: '1.5rem' }}>High-impact actions at each stage of the legislative process to stop bad bills or pass good ones.</p>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                            {stages.map((s, i) => (
                                <div key={i} style={{ backgroundColor: '#f8fafc', border: '2px solid #e2e8f0', borderRadius: '0.75rem', padding: '1.25rem' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.75rem' }}>
                                        <span style={{ fontSize: '1.5rem' }}>{s.icon}</span>
                                        <div>
                                            <h3 style={{ fontWeight: 700, color: '#1e3a8a', fontSize: '1.1rem' }}>{s.stage}</h3>
                                            <span style={{ display: 'inline-block', backgroundColor: '#dbeafe', color: '#1e40af', padding: '0.125rem 0.5rem', borderRadius: '0.25rem', fontSize: '0.8125rem', fontWeight: 600 }}>Pro Move: {s.proMove}</span>
                                        </div>
                                    </div>
                                    <p style={{ color: '#334155', fontSize: '0.9375rem', lineHeight: '1.6', margin: '0 0 0.5rem 0' }}>{s.description}</p>
                                    <p style={{ color: '#475569', fontSize: '0.8125rem', margin: 0, fontFamily: 'monospace', backgroundColor: 'white', padding: '0.5rem', borderRadius: '0.25rem' }}>üõ†Ô∏è {s.tools}</p>
                                </div>
                            ))}
                        </div>
                        <div style={{ marginTop: '1.5rem', padding: '1rem', backgroundColor: '#eff6ff', borderRadius: '0.75rem', border: '2px solid #93c5fd' }}>
                            <p style={{ fontSize: '0.875rem', color: '#1e293b', margin: 0 }}>üí° The earlier you act, the easier it is to stop or shape a bill. Introduction and Committee stages are where most bills die.</p>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================
        // REPEAL TRACKER MODAL
        // ============================================
        
        function RepealTrackerModal({ isOpen, onClose }) {
            const [showSupportModal, setShowSupportModal] = useState(null);
            const [showLearnModal, setShowLearnModal] = useState(null);
            const badLaws = [
                { name: 'PATRIOT Act Sections 215 & 702', passed: '2001', issue: 'Mass surveillance of Americans without warrants', status: 'Partially reformed in 2015, still active', repealBills: ['H.R. 224 - End Warrantless Surveillance Act'] },
                { name: 'FOSTA-SESTA', passed: '2018', issue: "Censored internet speech, harmed sex workers' safety", status: 'Still in effect', repealBills: ['H.R. 1865 - SAFE SEX Workers Study Act'] },
                { name: 'Civil Asset Forfeiture Laws', passed: 'Various dates', issue: 'Police can seize property without conviction', status: 'Active in most states', repealBills: ['H.R. 540 - FAIR Act'] }
            ];
            if (!isOpen) return null;
            return (
                <>
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#dc2626' }}>üî• Laws We're Fighting to Repeal</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                            {badLaws.map((law, i) => (
                                <div key={i} className="card" style={{ borderLeft: '4px solid #dc2626' }}>
                                    <h3 style={{ fontWeight: 700, color: '#dc2626', marginBottom: '0.25rem' }}>{law.name}</h3>
                                    <div style={{ fontSize: '0.875rem', color: '#334155', marginBottom: '0.75rem' }}>Passed {law.passed}</div>
                                    <div style={{ backgroundColor: '#fee2e2', padding: '0.75rem', borderRadius: '0.5rem', marginBottom: '0.75rem' }}>
                                        <div style={{ fontWeight: 600, color: '#991b1b', marginBottom: '0.25rem', fontSize: '0.8125rem' }}>Why It's Bad:</div>
                                        <div style={{ fontSize: '0.875rem', color: '#334155' }}>{law.issue}</div>
                                    </div>
                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                        <button onClick={() => setShowSupportModal(law)} className="btn btn-primary" style={{ flex: 1, fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>Support Repeal</button>
                                        <button onClick={() => setShowLearnModal(law)} className="btn btn-secondary" style={{ flex: 1, fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>Learn More</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
                {showSupportModal && <SupportRepealModal isOpen={true} onClose={() => setShowSupportModal(null)} lawName={showSupportModal.name} repealBills={showSupportModal.repealBills} />}
                {showLearnModal && <LearnMoreModal isOpen={true} onClose={() => setShowLearnModal(null)} law={showLearnModal} />}
                </>
            );
        }

        // ============================================
        // WINS & LOSSES FEED
        // ============================================
        
        function VictoryDefeatFeed({ isOpen, onClose }) {
            const outcomes = [
                { type: 'failed', bill: 'H.R. 3452 - EARN IT Act', date: '2024-12-15', description: 'Bill that would have undermined encryption defeated in committee', significance: 'Major privacy protection preserved', votes: { chamber: 'House Judiciary Committee', total: { yes: 5, no: 36 } } },
                { type: 'passed', bill: 'H.R. 7888 - TikTok Ban', date: '2024-11-20', description: 'Bill forcing sale or ban of TikTok signed into law', significance: 'First Amendment concerns over content-based app ban', votes: { house: { total: { yes: 352, no: 65 } }, senate: { total: { yes: 79, no: 18 } } } },
                { type: 'passed', bill: 'S. 2144 - Right to Repair Act', date: '2024-10-05', description: 'Consumer right to repair electronics passed the Senate', significance: 'Major win for consumer rights', votes: { senate: { total: { yes: 63, no: 37 } } } }
            ];
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                            <h2 className="heading-primary" style={{ fontSize: '1.75rem', color: '#1e3a8a' }}>üìä Wins & Losses</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                            {outcomes.map((o, i) => (
                                <div key={i} className="card" style={{ borderLeft: `4px solid ${o.type === 'passed' ? '#10b981' : '#ef4444'}` }}>
                                    <div style={{ display: 'inline-block', padding: '0.25rem 0.75rem', borderRadius: '9999px', backgroundColor: o.type === 'passed' ? '#dcfce7' : '#fee2e2', color: o.type === 'passed' ? '#166534' : '#991b1b', fontWeight: 700, fontSize: '0.75rem', textTransform: 'uppercase', marginBottom: '0.5rem' }}>
                                        {o.type === 'passed' ? '‚úÖ PASSED' : '‚ùå NOT PASSED'}
                                    </div>
                                    <h3 style={{ fontWeight: 700, color: '#1e293b', marginBottom: '0.25rem' }}>{o.bill}</h3>
                                    <div style={{ fontSize: '0.8125rem', color: '#64748b', marginBottom: '0.5rem' }}>{formatDate(o.date)}</div>
                                    <p style={{ color: '#334155', marginBottom: '0.5rem', fontSize: '0.9375rem' }}>{o.description}</p>
                                    <div style={{ backgroundColor: o.type === 'passed' ? '#dcfce7' : '#fee2e2', padding: '0.5rem 0.75rem', borderRadius: '0.5rem', fontSize: '0.875rem' }}>
                                        <strong>üìå</strong> {o.significance}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================
        // CITY COUNCIL VIEW (LOCAL LEVEL)
        // ============================================
        
        function CityCouncilView({ city, onBack }) {
            const [members, setMembers] = useState([]);
            const [legislation, setLegislation] = useState([]);
            const [meetings, setMeetings] = useState([]);
            const [portalBase, setPortalBase] = useState('');
            const [loading, setLoading] = useState(true);
            const [activeSection, setActiveSection] = useState('members');
            const [selectedMember, setSelectedMember] = useState(null);
            const [memberVotes, setMemberVotes] = useState([]);
            const [loadingVotes, setLoadingVotes] = useState(false);
            const [selectedMatter, setSelectedMatter] = useState(null);
            const [matterDetail, setMatterDetail] = useState(null);
            const [loadingDetail, setLoadingDetail] = useState(false);
            
            // Fetch council data when city changes
            useEffect(() => {
                if (!city) return;
                // Reset per-city state and set the correct portal base for this city
                setPortalBase(getPortalBaseForCity(city));
                setSelectedMember(null);
                setMemberVotes([]);
                setSelectedMatter(null);
                setMatterDetail(null);
                const fetchData = async () => {
                    setLoading(true);
                    try {
                        const [membersRes, legRes, meetRes] = await Promise.all([
                            fetch(`/.netlify/functions/city-council?city=${encodeURIComponent(city)}&type=members`).then(r => r.json()).catch(() => ({ members: [] })),
                            fetch(`/.netlify/functions/city-council?city=${encodeURIComponent(city)}&type=legislation`).then(r => r.json()).catch(() => ({ legislation: [] })),
                            fetch(`/.netlify/functions/city-council?city=${encodeURIComponent(city)}&type=meetings`).then(r => r.json()).catch(() => ({ meetings: [] }))
                        ]);
                        setMembers(membersRes.members || []);
                        setLegislation(legRes.legislation || []);
                        setMeetings(meetRes.meetings || []);
                    } catch (err) {
                        console.error('Error fetching city council data:', err);
                    } finally { setLoading(false); }
                };
                fetchData();
            }, [city]);
            
            // Fetch voting history for selected member
            const viewMemberVotes = async (member) => {
                setSelectedMember(member);
                setLoadingVotes(true);
                try {
                    const res = await fetch(`/.netlify/functions/city-council?city=${encodeURIComponent(city)}&type=votes&personId=${member.id}`);
                    const data = await res.json();
                    if (data && data.source && !portalBase) { setPortalBase(data.source); }
setMemberVotes(data.votes || []);
                } catch (err) {
                    console.error('Error fetching votes:', err);
                    setMemberVotes([]);
                } finally { setLoadingVotes(false); }
            };
            
            // Fetch matter detail
            const viewMatterDetail = async (matter) => {
                setSelectedMatter(matter);
                setLoadingDetail(true);
                try {
                    const res = await fetch(`/.netlify/functions/city-council?city=${encodeURIComponent(city)}&type=matter-detail&matterId=${matter.id}`);
                    const data = await res.json();
                    setMatterDetail(data);
                    if (!portalBase && (data?.source || data?.matter?.source)) {
                        setPortalBase(data.source || data.matter.source);
                    }
                } catch (err) {
                    console.error('Error fetching matter detail:', err);
                    setMatterDetail(null);
                } finally { setLoadingDetail(false); }
            };
            
            if (loading) {
                return (
                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '4rem', gap: '1rem' }}>
                        <div className="spinner"></div>
                        <p style={{ color: '#64748b' }}>Loading {city} City Council data...</p>
                    </div>
                );
            }
            
            return (
                <div>
                    {/* City Header */}
                    <div style={{ background: 'linear-gradient(135deg, #0f172a, #1e3a8a)', borderRadius: '1rem', padding: '1.5rem', marginBottom: '1.5rem', color: 'white' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.75rem' }}>
                            <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>üèõÔ∏è {city} City Council</h2>
                            <button onClick={onBack} style={{ background: 'rgba(255,255,255,0.15)', border: 'none', color: 'white', padding: '0.5rem 1rem', borderRadius: '0.5rem', cursor: 'pointer', fontWeight: 600, fontSize: '0.8125rem' }}>‚Üê Back</button>
                        </div>
                        <div style={{ display: 'flex', gap: '1.5rem', fontSize: '0.9375rem', opacity: 0.9 }}>
                            <span>üë• {members.length} Members</span>
                            <span>üìã {legislation.length} Recent Bills</span>
                            <span>üìÖ {meetings.length} Upcoming Meetings</span>
                        </div>
                    </div>
                    
                    {/* Section Tabs */}
                    <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1.5rem' }}>
                        {[
                            { key: 'members', label: 'üë• Council Members', count: members.length },
                            { key: 'legislation', label: 'üìã Legislation', count: legislation.length },
                            { key: 'meetings', label: 'üìÖ Meetings', count: meetings.length }
                        ].map(tab => (
                            <button key={tab.key} onClick={() => setActiveSection(tab.key)} style={{ flex: 1, padding: '0.75rem', border: 'none', background: activeSection === tab.key ? '#1e3a8a' : 'white', color: activeSection === tab.key ? 'white' : '#334155', fontWeight: 700, cursor: 'pointer', borderRadius: '0.5rem', fontSize: '0.875rem' }}>
                                {tab.label} ({tab.count})
                            </button>
                        ))}
                    </div>
                    
                    {/* ---- COUNCIL MEMBERS ---- */}
                    {activeSection === 'members' && (
                        <div>
                            {members.length === 0 ? (
                                <div style={{ textAlign: 'center', padding: '3rem', background: 'white', borderRadius: '1rem' }}>
                                    <p style={{ color: '#64748b' }}>No active council members found for this city.</p>
                                </div>
                            ) : (
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '1rem' }}>
                                    {members.filter(m => m.fullName && !m.fullName.includes('System') && !m.fullName.includes('View Only')).map(member => (
                                        <div key={member.id} className="card" style={{ padding: '1.25rem' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.75rem' }}>
                                                <div>
                                                    <h3 style={{ fontWeight: 700, color: '#1e3a8a', fontSize: '1.1rem', marginBottom: '0.25rem' }}>{member.fullName}</h3>
                                                    {member.title && <div style={{ fontSize: '0.8125rem', color: '#64748b' }}>{member.title}</div>}
                                                    {member.bodyName && <div style={{ fontSize: '0.8125rem', color: '#334155', fontWeight: 600 }}>{member.bodyName}</div>}
                                                </div>
                                                <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: '#1e3a8a', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 700, fontSize: '1rem', flexShrink: 0 }}>
                                                    {member.firstName ? member.firstName[0] : '?'}{member.lastName ? member.lastName[0] : ''}
                                                </div>
                                            </div>
                                            
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.375rem', fontSize: '0.8125rem', marginBottom: '0.75rem' }}>
                                                {member.email && <div style={{ color: '#334155' }}>üìß <a href={`mailto:${member.email}`} style={{ color: '#1e3a8a' }}>{member.email}</a></div>}
                                                {member.phone && <div style={{ color: '#334155' }}>üìû {member.phone}</div>}
                                                {member.website && <div style={{ color: '#334155' }}>üåê <a href={member.website} target="_blank" style={{ color: '#1e3a8a' }}>Website</a></div>}
                                            </div>
                                            
                                            <button onClick={() => viewMemberVotes(member)} className="btn btn-primary" style={{ width: '100%', fontSize: '0.8125rem', padding: '0.5rem', justifyContent: 'center' }}>
                                                üó≥Ô∏è View Voting History
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* ---- LEGISLATION ---- */}
                    {activeSection === 'legislation' && (
                        <div>
                            {legislation.length === 0 ? (
                                <div style={{ textAlign: 'center', padding: '3rem', background: 'white', borderRadius: '1rem' }}>
                                    <p style={{ color: '#64748b' }}>No recent legislation found.</p>
                                </div>
                            ) : (
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                    {legislation.map(item => (
                                        <div key={item.id} className="card" style={{ padding: '1.25rem', borderLeft: item.status === 'Adopted' || item.status === 'Approved' ? '4px solid #10b981' : item.passedDate ? '4px solid #10b981' : '4px solid #3b82f6' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.375rem', flexWrap: 'wrap' }}>
                                                        <span style={{ fontWeight: 700, color: '#1e3a8a', fontSize: '0.9375rem' }}>{item.file}</span>
                                                        <span style={{ fontSize: '0.75rem', padding: '0.125rem 0.5rem', borderRadius: '9999px', background: '#f1f5f9', color: '#475569', fontWeight: 600 }}>{item.type}</span>
                                                        {item.status && <span style={{ fontSize: '0.75rem', padding: '0.125rem 0.5rem', borderRadius: '9999px', background: item.status === 'Adopted' ? '#dcfce7' : '#fef3c7', color: item.status === 'Adopted' ? '#166534' : '#92400e', fontWeight: 600 }}>{item.status}</span>}
                                                    </div>
                                                    <h3 style={{ fontWeight: 700, fontSize: '1rem', color: '#0f172a', marginBottom: '0.375rem' }}>{item.title || item.name}</h3>
                                                    {item.sponsor && <div style={{ fontSize: '0.8125rem', color: '#64748b' }}>Introduced by: <strong>{item.sponsor}</strong></div>}
                                                    {item.introduced && <div style={{ fontSize: '0.75rem', color: '#94a3b8' }}>Introduced: {formatDate(item.introduced)}</div>}
                                                </div>
                                            </div>
                                            <div style={{ display: 'flex', gap: '0.5rem', marginTop: '0.75rem' }}>
                                                <button onClick={() => viewMatterDetail(item)} className="btn btn-primary" style={{ flex: 1, fontSize: '0.8125rem', padding: '0.5rem' }}>üìã Details & History</button>
</div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* ---- UPCOMING MEETINGS ---- */}
                    {activeSection === 'meetings' && (
                        <div>
                            {meetings.length === 0 ? (
                                <div style={{ textAlign: 'center', padding: '3rem', background: 'white', borderRadius: '1rem' }}>
                                    <p style={{ color: '#64748b' }}>No upcoming meetings found.</p>
                                </div>
                            ) : (
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                    {meetings.map(meeting => {
                                        const meetDate = new Date(meeting.date);
                                        const daysUntil = Math.ceil((meetDate - new Date()) / (1000*60*60*24));
                                        const isThisWeek = daysUntil <= 7 && daysUntil >= 0;
                                        return (
                                            <div key={meeting.id} className="card" style={{ padding: '1.25rem', borderLeft: isThisWeek ? '4px solid #dc2626' : '4px solid #3b82f6' }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                                                    <div>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.375rem' }}>
                                                            {isThisWeek && <span style={{ fontSize: '0.75rem', padding: '0.125rem 0.5rem', borderRadius: '9999px', background: '#fee2e2', color: '#991b1b', fontWeight: 700, animation: 'pulse 2s infinite' }}>üî¥ THIS WEEK</span>}
                                                        </div>
                                                        <h3 style={{ fontWeight: 700, fontSize: '1.1rem', color: '#1e3a8a', marginBottom: '0.25rem' }}>{meeting.bodyName}</h3>
                                                        <div style={{ fontSize: '0.9375rem', color: '#334155', fontWeight: 600 }}>üìÖ {formatDate(meeting.date)} {meeting.time ? `at ${meeting.time}` : ''}</div>
                                                        {meeting.location && <div style={{ fontSize: '0.8125rem', color: '#64748b', marginTop: '0.25rem' }}>üìç {meeting.location}</div>}
                                                    </div>
                                                    <div style={{ textAlign: 'center', background: '#f1f5f9', borderRadius: '0.5rem', padding: '0.5rem 0.75rem', minWidth: '60px' }}>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 700, color: isThisWeek ? '#dc2626' : '#1e3a8a' }}>{daysUntil}</div>
                                                        <div style={{ fontSize: '0.6875rem', color: '#64748b' }}>days</div>
                                                    </div>
                                                </div>
                                                {(meeting.agendaURL || meeting.inSiteURL) && (
                                                    <div style={{ display: 'flex', gap: '0.5rem', marginTop: '0.75rem' }}>
                                                        {meeting.agendaURL && <button onClick={() => window.open(meeting.agendaURL, '_blank')} className="btn btn-primary" style={{ fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>üìã View Agenda</button>}
                                                        {meeting.inSiteURL && <button onClick={() => window.open(meeting.inSiteURL, '_blank')} className="btn btn-secondary" style={{ fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>üåê Meeting Page</button>}
                                                        {meeting.videoURL && <button onClick={() => window.open(meeting.videoURL, '_blank')} className="btn btn-secondary" style={{ fontSize: '0.8125rem', padding: '0.5rem 1rem' }}>üìπ Watch</button>}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* ---- MEMBER VOTING HISTORY MODAL ---- */}
                    {selectedMember && (
                        <div className="modal-overlay" onClick={() => setSelectedMember(null)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                    <h2 className="heading-primary" style={{ fontSize: '1.5rem', color: '#1e3a8a' }}>üó≥Ô∏è {selectedMember.fullName} ‚Äî Voting Record</h2>
                                    <button onClick={() => setSelectedMember(null)} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                                </div>
                                {selectedMember.title && <p style={{ color: '#64748b', marginBottom: '1rem' }}>{selectedMember.title} ‚Äî {selectedMember.bodyName}</p>}
                                
                                {loadingVotes ? (
                                    <div style={{ display: 'flex', justifyContent: 'center', padding: '3rem' }}><div className="spinner"></div></div>
                                ) : memberVotes.length === 0 ? (
                                    <div style={{ textAlign: 'center', padding: '2rem', background: '#f1f5f9', borderRadius: '0.75rem' }}>
                                        <p style={{ color: '#64748b' }}>No voting records available through the API for this member. Check the <a href={getCityPortalUrl(city) || '#'} target="_blank" style={{ color: '#1e3a8a' }}>city meeting portal</a> directly.</p>
                                    </div>
                                ) : (
                                    <div>
                                        {/* Vote summary */}
                                        {(() => {
                                            const yesVotes = memberVotes.filter(v => v.valueName && (v.valueName.toLowerCase().includes('aye') || v.valueName.toLowerCase().includes('yes'))).length;
                                            const noVotes = memberVotes.filter(v => v.valueName && (v.valueName.toLowerCase().includes('nay') || v.valueName.toLowerCase().includes('no'))).length;
                                            const absent = memberVotes.filter(v => v.valueName && (v.valueName.toLowerCase().includes('absent') || v.valueName.toLowerCase().includes('excused'))).length;
                                            return (
                                                <div style={{ display: 'flex', gap: '1rem', marginBottom: '1.5rem', flexWrap: 'wrap' }}>
                                                    <div style={{ flex: 1, minWidth: '100px', background: '#dcfce7', padding: '1rem', borderRadius: '0.75rem', textAlign: 'center' }}>
                                                        <div style={{ fontSize: '2rem', fontWeight: 700, color: '#166534' }}>{yesVotes}</div>
                                                        <div style={{ fontSize: '0.8125rem', color: '#166534' }}>Yes / Aye</div>
                                                    </div>
                                                    <div style={{ flex: 1, minWidth: '100px', background: '#fee2e2', padding: '1rem', borderRadius: '0.75rem', textAlign: 'center' }}>
                                                        <div style={{ fontSize: '2rem', fontWeight: 700, color: '#991b1b' }}>{noVotes}</div>
                                                        <div style={{ fontSize: '0.8125rem', color: '#991b1b' }}>No / Nay</div>
                                                    </div>
                                                    <div style={{ flex: 1, minWidth: '100px', background: '#f1f5f9', padding: '1rem', borderRadius: '0.75rem', textAlign: 'center' }}>
                                                        <div style={{ fontSize: '2rem', fontWeight: 700, color: '#64748b' }}>{absent}</div>
                                                        <div style={{ fontSize: '0.8125rem', color: '#64748b' }}>Absent</div>
                                                    </div>
                                                </div>
                                            );
                                        })()}
                                        <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                                            {memberVotes.slice(0, 50).map((vote, i) => (
                                                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem 0', borderBottom: '1px solid #e2e8f0' }}>
                                                    <span style={{ width: '60px', textAlign: 'center', padding: '0.25rem 0.5rem', borderRadius: '0.25rem', fontSize: '0.75rem', fontWeight: 700, background: vote.valueName?.toLowerCase().includes('aye') || vote.valueName?.toLowerCase().includes('yes') ? '#dcfce7' : vote.valueName?.toLowerCase().includes('nay') || vote.valueName?.toLowerCase().includes('no') ? '#fee2e2' : '#f1f5f9', color: vote.valueName?.toLowerCase().includes('aye') || vote.valueName?.toLowerCase().includes('yes') ? '#166534' : vote.valueName?.toLowerCase().includes('nay') || vote.valueName?.toLowerCase().includes('no') ? '#991b1b' : '#64748b' }}>
                                                        {vote.valueName || 'N/A'}
                                                    </span>
                                                    <div style={{ flex: 1, fontSize: '0.875rem', color: '#334155' }}>
                                                        Vote #{vote.eventItemId} {vote.result ? `‚Äî ${vote.result}` : ''}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    
                    {/* ---- MATTER DETAIL MODAL ---- */}
                    {selectedMatter && (
                        <div className="modal-overlay" onClick={() => { setSelectedMatter(null); setMatterDetail(null); }}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                    <h2 className="heading-primary" style={{ fontSize: '1.5rem', color: '#1e3a8a' }}>üìã {selectedMatter.file} ‚Äî Details</h2>
                                    <button onClick={() => { setSelectedMatter(null); setMatterDetail(null); }} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>‚úï</button>
                                </div>
                                <h3 style={{ fontWeight: 700, color: '#0f172a', marginBottom: '1rem' }}>{selectedMatter.title || selectedMatter.name}</h3>
                                
                                {loadingDetail ? (
                                    <div style={{ display: 'flex', justifyContent: 'center', padding: '3rem' }}><div className="spinner"></div></div>
                                ) : matterDetail ? (
                                    <div>
                                        {/* Sponsors */}
                                        {matterDetail.sponsors && matterDetail.sponsors.length > 0 && (
                                            <div style={{ marginBottom: '1.5rem' }}>
                                                <h4 style={{ fontWeight: 700, marginBottom: '0.5rem', color: '#1e293b' }}>Introduced By</h4>
                                                <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                                                    {matterDetail.sponsors.map((s, i) => (
                                                        <span key={i} style={{ background: '#eff6ff', color: '#1e3a8a', padding: '0.375rem 0.75rem', borderRadius: '9999px', fontSize: '0.875rem', fontWeight: 600, border: '1px solid #93c5fd' }}>{s.name}</span>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        
                                        {/* Legislative History */}
                                        {matterDetail.history && matterDetail.history.length > 0 && (
                                            <div style={{ marginBottom: '1.5rem' }}>
                                                <h4 style={{ fontWeight: 700, marginBottom: '0.75rem', color: '#1e293b' }}>üìä Legislative History</h4>
                                                <div style={{ borderLeft: '3px solid #1e3a8a', paddingLeft: '1rem' }}>
                                                    {matterDetail.history.map((h, i) => (
                                                        <div key={i} style={{ marginBottom: '1rem', position: 'relative' }}>
                                                            <div style={{ position: 'absolute', left: '-1.5rem', top: '0.25rem', width: '12px', height: '12px', borderRadius: '50%', background: h.passed ? '#10b981' : '#3b82f6', border: '2px solid white' }} />
                                                            <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.125rem' }}>{formatDate(h.date)}</div>
                                                            <div style={{ fontWeight: 600, color: '#1e293b', fontSize: '0.9375rem' }}>{h.action}</div>
                                                            {h.body && <div style={{ fontSize: '0.8125rem', color: '#475569' }}>By: {h.body}</div>}
                                                            {h.tally && <div style={{ fontSize: '0.8125rem', color: '#1e3a8a', fontWeight: 600, marginTop: '0.25rem' }}>Vote: {h.tally}</div>}
                                                            {h.description && <div style={{ fontSize: '0.8125rem', color: '#64748b', marginTop: '0.25rem' }}>{h.description}</div>}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
<div style={{ background: '#f8fafc', border: '1px solid #e2e8f0', borderRadius: '0.75rem', padding: '1rem' }}>
        <div style={{ fontWeight: 700, color: '#1e3a8a', marginBottom: '0.5rem' }}>üéì Learn More</div>
        <div style={{ color: '#475569', fontSize: '0.95rem', marginBottom: '0.75rem' }}>
            Many cities publish the most helpful documents (agenda packet, staff memo, meeting video) on the meeting calendar.
        </div>
        <button
            onClick={() => {
                const base = portalBase || '';
                const url = base ? `${base.replace(/\/$/, '')}/Calendar.aspx` : null;
                if (url) window.open(url, '_blank');
            }}
            className="btn btn-secondary"
            style={{ width: '100%', justifyContent: 'center' }}
        >
            üóìÔ∏è Open City Meeting Calendar
        </button>
    </div>
</div>
                                    </div>
                                ) : (
                                    <div style={{ background: '#f1f5f9', padding: '1.5rem', borderRadius: '0.75rem', textAlign: 'center' }}>
                                        <p style={{ color: '#64748b' }}>Unable to load details. <a href={selectedMatter.url} target="_blank" style={{ color: '#1e3a8a' }}>View on Legistar</a></p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    
                    {/* Source attribution */}
                    <div style={{ marginTop: '1.5rem', textAlign: 'center', fontSize: '0.75rem', color: '#94a3b8' }}>
                        Data sourced from <a href={portalBase || '#'} onClick={(e) => { if (!portalBase) e.preventDefault(); }} target="_blank" style={{ color: '#64748b' }}>{city} Legistar Portal</a> via Granicus API
                    </div>
                </div>
            );
        }

        // ============================================
        // BILL CARD (Simplified)
        // ============================================
        
        function BillCard({ bill, onViewDetails, watchlist, toggleWatchlist }) {
            const impactClass = `impact-${bill.impactLevel}`;
            return (
                <div className={`card ${impactClass}`} style={{ marginBottom: '1rem' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>
                        <div style={{ flex: 1 }}>
                            <BillTitle bill={bill} />
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', flexWrap: 'wrap', marginBottom: '0.5rem' }}>
                                <StatusBadge status={bill.status} statusDisplay={bill.statusDisplay} statusPriority={bill.statusPriority} />
                                {bill.date && <span style={{ fontSize: '0.75rem', color: '#64748b' }}>Last action: {formatDate(bill.date)}</span>}
                            </div>
                        </div>
                        <button onClick={(e) => { e.stopPropagation(); toggleWatchlist(bill.id); }} style={{ background: 'none', border: 'none', fontSize: '1.75rem', cursor: 'pointer', padding: '0.25rem', filter: watchlist.includes(bill.id) ? 'none' : 'grayscale(100%)', opacity: watchlist.includes(bill.id) ? 1 : 0.4 }} title={watchlist.includes(bill.id) ? 'Remove from watchlist' : 'Add to watchlist'}>‚≠ê</button>
                    </div>
                    <p style={{ color: '#334155', marginBottom: '0.75rem', lineHeight: '1.6', fontSize: '0.9375rem' }}>{stripHtml(bill.howItAffectsYou || bill.title)}</p>
                    {bill.voteDate && <CountdownTimer voteDate={bill.voteDate} billNumber={bill.number} />}
                    <div style={{ display: 'flex', gap: '0.5rem', marginTop: '0.75rem' }}>
                        <button onClick={() => onViewDetails(bill)} className="btn btn-primary" style={{ flex: 1 }}>üìã View Details & Take Action</button>
                        <button onClick={() => window.open(bill.url, '_blank', 'noopener,noreferrer')} className="btn btn-secondary" style={{ flex: '0 0 auto' }}>üìÑ Read</button>
                    </div>
                </div>
            );
        }

        // ============================================
        // BILL DETAILS MODAL (Preserved with full functionality)
        // ============================================
        
        function BillDetailsModal({ bill, onClose }) {
            const [showShareStory, setShowShareStory] = useState(false);
            const [userZipCode, setUserZipCode] = useState(() => localStorage.getItem('userZipCode') || '');
            const [copiedScript, setCopiedScript] = useState(false);
            const [copiedEmail, setCopiedEmail] = useState(false);
            const [activeTab, setActiveTab] = useState('overview');
            
            if (!bill) return null;
            
            const isCeremonial = () => {
                const titleLower = bill.title.toLowerCase();
                return ['honoring','commemorating','recognizing','congratulating','expressing','commending','tribute','resolution','death of','memory of','celebrating','designation of'].some(kw => titleLower.includes(kw));
            };
            const ceremonial = isCeremonial();
            
            const getCallScript = () => {
                let keyPoints = [];
                if (bill.provisions && bill.provisions.length > 0) {
                    bill.provisions.slice(0, 3).forEach(p => {
                        if (p.type === 'deadline') keyPoints.push(`establishes ${p.text}`);
                        else if (p.type === 'funding') keyPoints.push(`appropriates ${p.text}`);
                        else if (p.type === 'position') keyPoints.push(`creates ${p.text} position`);
                        else keyPoints.push(p.text);
                    });
                }
                const pointsText = keyPoints.length > 0 ? `Specifically, this bill ${keyPoints.join(', ')}.` : 'The bill contains provisions that require careful review.';
                return `CALL SCRIPT FOR ${bill.number}\n\nStep 1: Introduce Yourself\n\nStaffer: "Office of [Senator/Representative Name], how can I help you?"\n\nYou: "Hello, my name is [Your Full Name] and I am a constituent from [City], ZIP code [Your ZIP]. I am calling to ${bill.statusPriority >= 7 ? 'urge support for' : 'provide input on'} ${bill.number}, ${bill.title}."\n\nStep 2: State Your Position\n\nYou: "I am calling because ${stripHtml(bill.howItAffectsYou || bill.title).substring(0, 120)}...\n\n${pointsText}"\n\nStep 3: Make Your Ask\n\nYou: "Can you tell me where the office stands on ${bill.number}? I would appreciate it if you could record my input."\n\nStep 4: Close\n\nYou: "I appreciate your time. Have a great day."\n\nüí° TIPS: Speak clearly, have your ZIP ready, take notes, follow up with email, call during 9AM-5PM, be polite.`;
            };
            
            const getEmailTemplate = () => {
                let provisionsList = '';
                if (bill.provisions && bill.provisions.length > 0) {
                    const items = bill.provisions.slice(0, 4).map(p => `‚Ä¢ ${p.text}`);
                    if (items.length > 0) provisionsList = items.join('\n');
                }
                if (!provisionsList) provisionsList = '‚Ä¢ This bill requires thorough analysis\n‚Ä¢ May have unintended consequences\n‚Ä¢ Congressional oversight is essential';
                return `Subject: Constituent Input on ${bill.number} ‚Äì ${bill.title}\n\nDear [Senator/Representative],\n\nMy name is [Your Full Name] and I am a constituent from [Your City/Zip Code]. I am writing regarding ${bill.number}, ${bill.title}.\n\nThis legislation addresses ${stripHtml(bill.howItAffectsYou || bill.title).substring(0, 150)}...\n\nKey provisions:\n${provisionsList}\n\nPlease record my input on ${bill.number}.\n\nSincerely,\n[Your Full Name]\n[Your Phone Number]\n[Your Address]`;
            };
            
            const getUrgency = () => {
                if (bill.statusPriority >= 10) return { text: 'This is now law', color: '#10b981' };
                if (bill.statusPriority >= 7) return { text: 'üö® URGENT: Vote imminent!', color: '#ef4444' };
                if (bill.statusPriority >= 5) return { text: '‚ö†Ô∏è Moving forward - act now', color: '#f59e0b' };
                return { text: 'Monitor this bill', color: '#3b82f6' };
            };
            const urgency = getUrgency();
            
            const saveZipCode = () => { if (userZipCode && userZipCode.length === 5) { localStorage.setItem('userZipCode', userZipCode); } };
            const copyCallScript = () => { navigator.clipboard.writeText(getCallScript()); setCopiedScript(true); setTimeout(() => setCopiedScript(false), 2000); };
            const copyEmailTemplate = () => { navigator.clipboard.writeText(getEmailTemplate()); setCopiedEmail(true); setTimeout(() => setCopiedEmail(false), 2000); };
            
            return (
                <>
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{ maxWidth: '900px', maxHeight: '90vh', overflow: 'auto' }}>
                        {/* Header */}
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1.5rem', paddingBottom: '1rem', borderBottom: '2px solid #e2e8f0' }}>
                            <div style={{ flex: 1 }}>
                                <h2 className="heading-primary" style={{ fontSize: '1.375rem', color: '#1e3a8a', marginBottom: '0.5rem' }}>
                                    <a href={bill.url} target="_blank" rel="noopener noreferrer" style={{ color: '#1e3a8a', textDecoration: 'underline' }}>{bill.number}</a>
                                    {' - '}{bill.title}
                                </h2>
                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center', flexWrap: 'wrap' }}>
                                    <StatusBadge status={bill.status} statusDisplay={bill.statusDisplay} statusPriority={bill.statusPriority} />
                                    {!ceremonial && <span style={{ backgroundColor: urgency.color, color: 'white', padding: '0.25rem 0.75rem', borderRadius: '0.5rem', fontSize: '0.75rem', fontWeight: 700 }}>{urgency.text}</span>}
                                </div>
                            </div>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', padding: '0 0.5rem' }}>‚úï</button>
                        </div>
                        
                        {ceremonial ? (
                            <div style={{ textAlign: 'center', padding: '2rem' }}>
                                <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üèõÔ∏è</div>
                                <h3 style={{ fontSize: '1.25rem', color: '#1e3a8a', marginBottom: '0.75rem' }}>Ceremonial Resolution</h3>
                                <p style={{ color: '#334155', lineHeight: '1.7', maxWidth: '600px', margin: '0 auto 1.5rem' }}>This resolution is ceremonial. It does not create new laws or affect your rights.</p>
                                <button onClick={onClose} className="btn btn-primary">View Substantive Bills</button>
                            </div>
                        ) : (
                            <>
                                {/* Tabs */}
                                <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1.5rem', borderBottom: '2px solid #e2e8f0' }}>
                                    {['overview', 'action', 'details'].map(tab => (
                                        <button key={tab} onClick={() => setActiveTab(tab)} style={{ padding: '0.75rem 1.25rem', border: 'none', background: activeTab === tab ? '#1e3a8a' : 'transparent', color: activeTab === tab ? 'white' : '#334155', fontWeight: 600, cursor: 'pointer', borderRadius: '0.5rem 0.5rem 0 0', textTransform: 'capitalize', fontSize: '0.9375rem' }}>
                                            {tab === 'overview' ? 'üìã Overview' : tab === 'action' ? 'üìû Take Action' : 'üìä Details'}
                                        </button>
                                    ))}
                                </div>
                                
                                {/* OVERVIEW */}
                                {activeTab === 'overview' && (
                                    <div>
                                        <div style={{ backgroundColor: '#f8fafc', border: '2px solid #e2e8f0', borderRadius: '0.75rem', padding: '1.25rem', marginBottom: '1.5rem' }}>
                                            <h3 style={{ fontWeight: 700, marginBottom: '0.75rem', color: '#1e293b' }}>How This Affects You</h3>
                                            <p style={{ color: '#334155', lineHeight: '1.7', margin: 0 }}>{stripHtml(bill.howItAffectsYou || bill.title)}</p>
                                        </div>
                                        <button onClick={() => setActiveTab('action')} className="btn btn-primary" style={{ width: '100%', justifyContent: 'center', fontSize: '1.1rem', padding: '1rem', marginBottom: '1.5rem' }}>üìû Call ‚Ä¢ ‚úâÔ∏è Email ‚Ä¢ üì± Share ‚Üí</button>
                                        <div style={{ backgroundColor: '#f8fafc', border: '2px solid #e2e8f0', borderRadius: '0.75rem', padding: '1rem' }}>
                                            <p style={{ fontSize: '0.95rem', color: '#334155', lineHeight: '1.7', margin: 0 }}><strong>Latest Action:</strong> {bill.status}</p>
                                        </div>
                                    </div>
                                )}
                                
                                {/* ACTION */}
                                {activeTab === 'action' && (
                                    <div>
                                        {!userZipCode && (
                                            <div style={{ backgroundColor: '#fef3c7', border: '2px solid #fde68a', borderRadius: '0.75rem', padding: '1.25rem', marginBottom: '1.5rem' }}>
                                                <h3 style={{ fontWeight: 700, marginBottom: '0.5rem' }}>üìç Enter Your Zip Code</h3>
                                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                    <input type="text" placeholder="85001" value={userZipCode} onChange={(e) => setUserZipCode(e.target.value.replace(/\D/g, '').slice(0, 5))} style={{ flex: 1, padding: '0.75rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem' }} />
                                                    <button onClick={saveZipCode} className="btn btn-primary" disabled={userZipCode.length !== 5}>Save</button>
                                                </div>
                                            </div>
                                        )}
                                        {userZipCode && (
                                            <div style={{ backgroundColor: '#f1f5f9', padding: '1rem', borderRadius: '0.75rem', marginBottom: '1.5rem' }}>
                                                <p style={{ fontSize: '0.875rem', color: '#334155', marginBottom: '0.5rem' }}><strong>Zip: {userZipCode}</strong> | <button onClick={() => setUserZipCode('')} style={{ background: 'none', border: 'none', color: '#1e3a8a', textDecoration: 'underline', cursor: 'pointer' }}>Change</button></p>
                                                <p style={{ fontSize: '0.8125rem', color: '#475569', margin: 0 }}>Find your reps: <a href="https://www.senate.gov/senators/senators-contact.htm" target="_blank" style={{ color: '#1e3a8a' }}>Senate</a> | <a href="https://www.house.gov/representatives/find-your-representative" target="_blank" style={{ color: '#1e3a8a' }}>House</a></p>
                                            </div>
                                        )}
                                        
                                        <div style={{ marginBottom: '1.5rem' }}>
                                            <h3 style={{ fontWeight: 700, marginBottom: '0.75rem', fontSize: '1.1rem' }}>üìù Call Script</h3>
                                            <div style={{ backgroundColor: '#f8fafc', border: '2px solid #e2e8f0', borderRadius: '0.75rem', padding: '1.25rem' }}>
                                                <pre style={{ whiteSpace: 'pre-wrap', fontFamily: 'inherit', fontSize: '0.9375rem', lineHeight: '1.7', margin: 0, color: '#334155' }}>{getCallScript()}</pre>
                                                <button onClick={copyCallScript} className="btn btn-secondary" style={{ marginTop: '1rem' }}>{copiedScript ? '‚úì Copied!' : 'üìã Copy Script'}</button>
                                            </div>
                                        </div>
                                        
                                        <div style={{ marginBottom: '1.5rem' }}>
                                            <h3 style={{ fontWeight: 700, marginBottom: '0.75rem', fontSize: '1.1rem' }}>‚úâÔ∏è Email Template</h3>
                                            <div style={{ backgroundColor: '#f8fafc', border: '2px solid #e2e8f0', borderRadius: '0.75rem', padding: '1.25rem' }}>
                                                <pre style={{ whiteSpace: 'pre-wrap', fontFamily: 'inherit', fontSize: '0.9375rem', lineHeight: '1.7', margin: 0, color: '#334155' }}>{getEmailTemplate()}</pre>
                                                <button onClick={copyEmailTemplate} className="btn btn-secondary" style={{ marginTop: '1rem' }}>{copiedEmail ? '‚úì Copied!' : 'üìã Copy Email'}</button>
                                            </div>
                                        </div>
                                        
                                        <div style={{ backgroundColor: '#dcfce7', border: '2px solid #86efac', borderRadius: '0.75rem', padding: '1.25rem' }}>
                                            <h3 style={{ fontWeight: 700, color: '#166534', marginBottom: '0.5rem' }}>‚úÖ Did You Take Action?</h3>
                                            <button onClick={() => setShowShareStory(true)} className="btn btn-primary">üì¢ Share My Story</button>
                                        </div>
                                    </div>
                                )}
                                
                                {/* DETAILS */}
                                {activeTab === 'details' && (
                                    <div>
                                        <BeforeAfterComparison bill={bill} />
                                        <SupportOppose bill={bill} />
                                        <div style={{ marginTop: '1.5rem' }}>
                                            <button onClick={() => window.open(bill.url, '_blank', 'noopener,noreferrer')} className="btn btn-primary" style={{ width: '100%', justifyContent: 'center' }}>üìÑ Read Full Bill on {bill.state && bill.state !== 'US' ? 'LegiScan' : 'Congress.gov'}</button>
                                        </div>
                                    </div>
                                )}
                                
                                <div style={{ marginTop: '2rem', paddingTop: '1rem', borderTop: '2px solid #e2e8f0' }}>
                                    <button onClick={onClose} className="btn btn-secondary" style={{ width: '100%', justifyContent: 'center' }}>Close</button>
                                </div>
                            </>
                        )}
                    </div>
                </div>
                <ShareStoryModal isOpen={showShareStory} onClose={() => setShowShareStory(false)} billId={bill.id} billTitle={bill.title} />
                </>
            );
        }

        // ============================================
        // MAIN APP - SIMPLIFIED LAYOUT
        // ============================================
        
        function CivicAlertApp() {
            

const [bills, setBills] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterImpact, setFilterImpact] = useState('all');
            const [filterTopic, setFilterTopic] = useState('all');
            const [sortBy, setSortBy] = useState('urgent');
            const [searchQuery, setSearchQuery] = useState('');
            const [activeTab, setActiveTab] = useState('all');
            const [level, setLevel] = useState('federal');
            const [selectedCity, setSelectedCity] = useState('');
            
        
const [selectedState, setSelectedState] = useState('');
            const [watchlist, setWatchlist] = useState(() => { const s = localStorage.getItem('billWatchlist'); return s ? JSON.parse(s) : []; });
            const [selectedBill, setSelectedBill] = useState(null);
            const [showSubscribe, setShowSubscribe] = useState(false);
            const [showRepresentatives, setShowRepresentatives] = useState(false);
            const [showRepealTracker, setShowRepealTracker] = useState(false);
            const [showVictoryFeed, setShowVictoryFeed] = useState(false);
            const [showDonateModal, setShowDonateModal] = useState(false);
            const [showStrategicGuide, setShowStrategicGuide] = useState(false);
            const [showDrawer, setShowDrawer] = useState(false);
            const [showFilters, setShowFilters] = useState(false);
            
            useEffect(() => { localStorage.setItem('billWatchlist', JSON.stringify(watchlist)); }, [watchlist]);
            
            const toggleWatchlist = (billId) => { setWatchlist(prev => prev.includes(billId) ? prev.filter(id => id !== billId) : [...prev, billId]); };
            
            const getBillTopic = (bill) => {
                const combined = (bill.title + ' ' + (bill.howItAffectsYou || '')).toLowerCase();
                const topics = {
                    privacy: ['privacy','surveillance','data collection','facial recognition','biometric','tracking','encryption','warrant','fourth amendment','data breach','personal information','cybersecurity','backdoor','fisa','patriot act'],
                    healthcare: ['health','medical','hospital','medicare','medicaid','insurance','prescription','drug','pharmacy','healthcare','patient','doctor','vaccine','mental health','addiction','opioid','abortion','reproductive','affordable care act','coverage'],
                    taxes: ['tax','irs','internal revenue','deduction','credit','income tax','sales tax','property tax','estate tax','capital gains','revenue','tariff','taxation','taxpayer','refund','tax code','tax reform','tax rate'],
                    guns: ['gun','firearm','weapon','ammunition','second amendment','background check','concealed carry','assault weapon','rifle','gun control','gun safety','gun violence','atf'],
                    voting: ['voting','voter','election','ballot','polling','registration','voter id','gerrymandering','redistricting','electoral','campaign finance','absentee','early voting','voter suppression'],
                    education: ['education','school','student','teacher','university','college','tuition','student loan','scholarship','curriculum','title ix','special education','charter school','voucher','pell grant'],
                    climate: ['climate','environment','pollution','emission','carbon','renewable','solar','wind','fossil fuel','oil','gas','coal','clean energy','epa','clean air','clean water','conservation','global warming','sustainability'],
                    immigration: ['immigration','immigrant','border','visa','refugee','asylum','deportation','citizenship','naturalization','green card','undocumented','daca','dreamers','border security','migrant'],
                    justice: ['justice','criminal','crime','prison','jail','incarceration','sentencing','police','law enforcement','civil rights','discrimination','due process','bail','reform','death penalty','racial justice'],
                    labor: ['labor','worker','employment','wage','minimum wage','overtime','union','collective bargaining','workplace','osha','worker rights','gig worker','unemployment','paid leave','family leave','sick leave']
                };
                for (const [topic, keywords] of Object.entries(topics)) {
                    if (keywords.some(kw => combined.includes(kw))) return topic;
                }
                return 'other';
            };
            
            useEffect(() => {
                const fetchBills = async () => {
                    try {
                        setLoading(true);
                        let url = '';
                        if (level === 'federal') url = '/.netlify/functions/get-bills';
                        else if (level === 'state' && selectedState) url = `/.netlify/functions/state-bills?state=${selectedState}`;
                        else { setBills([]); setLoading(false); return; }
                        const response = await fetch(url);
                        if (!response.ok) throw new Error(`API error: ${response.status}`);
                        const data = await response.json();
                        if (data.bills && Array.isArray(data.bills)) {
                            setBills(data.bills.map(bill => ({ ...bill, topic: getBillTopic(bill) })));
                        } else { setBills([]); }
                    } catch (error) {
                        console.error('Error fetching bills:', error);
                        setBills([]);
                    } finally { setLoading(false); }
                };
                fetchBills();
            }, [level, selectedState]);
            
            const filteredBills = (() => {
                let result = bills;
                if (activeTab === 'watchlist') result = result.filter(b => watchlist.includes(b.id));
                if (filterImpact !== 'all') result = result.filter(b => b.impactLevel === filterImpact);
                if (filterTopic !== 'all') result = result.filter(b => b.topic === filterTopic);
                if (searchQuery.trim()) {
                    const q = searchQuery.toLowerCase();
                    result = result.filter(b => b.number.toLowerCase().includes(q) || b.title.toLowerCase().includes(q) || b.howItAffectsYou?.toLowerCase().includes(q));
                }
                return [...result].sort((a, b) => {
                    if (sortBy === 'recent') return new Date(b.date) - new Date(a.date);
                    if (sortBy === 'oldest') return new Date(a.date) - new Date(b.date);
                    return (b.statusPriority !== a.statusPriority) ? b.statusPriority - a.statusPriority : new Date(b.date) - new Date(a.date);
                });
            })();

            const states = ['Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts','Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada','New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma','Oregon','Pennsylvania','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont','Virginia','Washington','West Virginia','Wisconsin','Wyoming'];

            const availableCities = [
                'Phoenix, AZ',
                'Tucson, AZ',
                'Mesa, AZ',
                'Gilbert, AZ',
                'Chandler, AZ',
                'Glendale, AZ',
                'Scottsdale, AZ',
                'Peoria, AZ',
                'Tempe, AZ',
                'Surprise, AZ',
                'Goodyear, AZ',
                'Buckeye, AZ',
                'San Tan Valley, AZ',
                'Yuma, AZ',
                'Avondale, AZ',
                'Queen Creek, AZ',
                'Flagstaff, AZ',
                'Maricopa, AZ',
                'Lake Havasu City, AZ',
                'Casa Grande, AZ',
                'Marana, AZ',
                'Prescott Valley, AZ',
                'Oro Valley, AZ',
                'Prescott, AZ',
                'Sierra Vista, AZ',
                'Bullhead City, AZ',
                'Apache Junction, AZ',
                'El Mirage, AZ',
                'Kingman, AZ',
                'Sahuarita, AZ',
                'San Luis, AZ',
                'Florence, AZ',
                'Fountain Hills, AZ',
                'Nogales, AZ',
                'Eloy, AZ',
                'Coolidge, AZ',
                'Payson, AZ',
                'Douglas, AZ',
                'Chino Valley, AZ',
                'Paradise Valley, AZ',
                'Cottonwood, AZ',
                'Camp Verde, AZ',
                'Show Low, AZ',
                'Safford, AZ',
                'Sedona, AZ',
                'Winslow, AZ',
                'Tolleson, AZ',
                'Wickenburg, AZ',
                'Globe, AZ',
                'Youngtown, AZ',
                'Litchfield Park, AZ',
                'Snowflake, AZ',
                'Benson, AZ',
                'Cave Creek, AZ',
                'Bisbee, AZ',
                'St. Johns, AZ',
                'Williams, AZ',
                'Willcox, AZ',
                'Taylor, AZ',
                'Pima, AZ',
                'Star Valley, AZ',
                'Superior, AZ',
                'Springerville, AZ',
                'Kearny, AZ',
                'Huachuca City, AZ',
                'Tombstone, AZ',
                'Fredonia, AZ',
                'Mammoth, AZ',
                'Patagonia, AZ',
                'Jerome, AZ',
                'Winkelman, AZ'
            ];

            const topicIcons = { all: 'üìã', privacy: 'üîí', healthcare: 'üè•', taxes: 'üí∞', guns: 'üî´', voting: 'üó≥Ô∏è', education: 'üìö', climate: 'üåç', immigration: 'üõÇ', justice: '‚öñÔ∏è', labor: 'üë∑' };
            
            return (
                <div style={{ minHeight: '100vh' }}>
                    {/* ===== HEADER - Clean, single bar ===== */}
                    <header style={{ background: 'linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%)', color: 'white', padding: '1.25rem 1rem', position: 'sticky', top: 0, zIndex: 100 }}>
                        <div style={{ maxWidth: '960px', margin: '0 auto', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                <span style={{ fontSize: '1.5rem' }}>üá∫üá∏</span>
                                <div>
                                    <h1 className="heading-display" style={{ fontSize: '1.5rem', lineHeight: 1.2, fontFamily: "'Crimson Pro', Georgia, serif" }}>Civic Rights Alert System</h1>
                                    <p style={{ margin: 0, fontSize: '0.75rem', opacity: 0.8 }}>Track legislation that affects your life</p>
                                </div>
                            </div>
                            <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                <button onClick={() => setShowSubscribe(true)} className="btn" style={{ backgroundColor: '#fbbf24', color: '#0f172a', padding: '0.5rem 1rem', fontSize: '0.8125rem' }}>üìß Alerts</button>
                                <button onClick={() => setShowDrawer(true)} className="btn" style={{ backgroundColor: 'rgba(255,255,255,0.15)', color: 'white', padding: '0.5rem 0.75rem', fontSize: '1.25rem', lineHeight: 1 }}>‚ò∞</button>
                            </div>
                        </div>
                    </header>
                    
                    {/* ===== MAIN CONTENT ===== */}
                    <main style={{ maxWidth: '960px', margin: '0 auto', padding: '1.5rem 1rem' }}>
                        
                        {/* Step 1: WHERE ‚Äî Level + State selector */}
                        <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem', flexWrap: 'wrap', alignItems: 'center' }}>
                            <button onClick={() => { setLevel('federal'); setSelectedState(''); setActiveTab('all'); }} style={{ padding: '0.625rem 1rem', borderRadius: '0.5rem', border: level === 'federal' ? '2px solid #1e3a8a' : '2px solid #cbd5e1', background: level === 'federal' ? '#1e3a8a' : 'white', color: level === 'federal' ? 'white' : '#334155', cursor: 'pointer', fontWeight: 600, fontSize: '0.9375rem' }}>üèõÔ∏è Federal</button>
                            
                            {selectedState === 'Arizona' && (
    <div style={{ position: 'relative' }}>
        <select 
            value={selectedCity}
            onChange={(e) => {
                const nextCity = e.target.value;
                setSelectedCity(nextCity);
                setActiveTab('all');
                if (nextCity) {
                    setLevel('local');
                } else {
                    setLevel('state');
                }
            }}
            style={{ padding: '0.625rem 2rem 0.625rem 1rem', borderRadius: '0.5rem', border: level === 'local' ? '2px solid #1e3a8a' : '2px solid #cbd5e1', background: level === 'local' ? '#1e3a8a' : 'white', color: level === 'local' ? 'white' : '#334155', cursor: 'pointer', fontWeight: 600, fontSize: '0.9375rem', appearance: 'none', WebkitAppearance: 'none' }}
        >
            <option value="">üåµ Select AZ City...</option>
            {availableCities.slice().sort((a,b)=>a.localeCompare(b)).map(c => <option key={c} value={c}>{c}</option>)}
        </select>
        <span style={{ position: 'absolute', right: '0.75rem', top: '50%', transform: 'translateY(-50%)', pointerEvents: 'none', fontSize: '0.75rem', color: level === 'local' ? 'white' : '#64748b' }}>‚ñº</span>
    </div>
)}

                        </div>
                        
                        {/* === LOCAL LEVEL: City Council View === */}
                        {level === 'local' && selectedCity ? (
                            <CityCouncilView 
                                city={selectedCity} 
                                onBack={() => { setLevel('federal'); setSelectedCity(''); }} 
                            />
                        ) : level === 'local' && !selectedCity ? (
                            <div style={{ textAlign: 'center', padding: '4rem 2rem', background: 'white', borderRadius: '1rem' }}>
                                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>üèòÔ∏è</div>
                                <h3 style={{ fontWeight: 700, color: '#1e3a8a', marginBottom: '0.5rem', fontSize: '1.5rem' }}>Select Your City</h3>
                                <p style={{ color: '#64748b', marginBottom: '1.5rem', maxWidth: '500px', margin: '0 auto 1.5rem' }}>Choose your city from the dropdown above to see your city council members, local legislation, and upcoming meetings. Every vote. Every bill. Total transparency.</p>
                                <div style={{ background: '#eff6ff', border: '1px solid #93c5fd', borderRadius: '0.75rem', padding: '1rem', maxWidth: '400px', margin: '0 auto' }}>
                                    <p style={{ fontSize: '0.875rem', color: '#1e3a8a', fontWeight: 600, marginBottom: '0.25rem' }}>üåµ Arizona Launch</p>
                                    <p style={{ fontSize: '0.8125rem', color: '#475569' }}>Arizona: city portal links are enabled for all listed cities. Deep data (members/votes) currently best on Legistar cities. More Arizona cities coming soon.</p>
                                </div>
                            </div>
                        ) : (
                        <>
                        {/* === FEDERAL / STATE LEVEL: Bill List === */}
                        {/* Tabs: All Bills / My Watchlist */}
                        <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem' }}>
                            <button onClick={() => setActiveTab('all')} style={{ flex: 1, padding: '0.75rem', border: 'none', background: activeTab === 'all' ? '#1e3a8a' : 'white', color: activeTab === 'all' ? 'white' : '#334155', fontWeight: 700, cursor: 'pointer', borderRadius: '0.5rem', fontSize: '0.9375rem' }}>üìã All Bills</button>
                            <button onClick={() => setActiveTab('watchlist')} style={{ flex: 1, padding: '0.75rem', border: 'none', background: activeTab === 'watchlist' ? '#1e3a8a' : 'white', color: activeTab === 'watchlist' ? 'white' : '#334155', fontWeight: 700, cursor: 'pointer', borderRadius: '0.5rem', fontSize: '0.9375rem', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>
                                ‚≠ê Watchlist
                                {watchlist.length > 0 && <span style={{ backgroundColor: activeTab === 'watchlist' ? '#fbbf24' : '#1e3a8a', color: activeTab === 'watchlist' ? '#0f172a' : 'white', borderRadius: '9999px', padding: '0.125rem 0.5rem', fontSize: '0.75rem', fontWeight: 700 }}>{watchlist.length}</span>}
                            </button>
                        </div>
                        
                        {/* Search */}
                        <div style={{ marginBottom: '1rem' }}>
                            <input type="text" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} placeholder="Search by bill number or keyword..." style={{ width: '100%', padding: '0.75rem 1rem', borderRadius: '0.5rem', border: '2px solid #e2e8f0', fontSize: '1rem', background: 'white' }} />
                        </div>
                        
                        {/* Topic pills - scrollable row */}
                        <div style={{ display: 'flex', gap: '0.375rem', marginBottom: '0.75rem', overflowX: 'auto', paddingBottom: '0.5rem' }}>
                            {Object.entries(topicIcons).map(([value, icon]) => (
                                <button key={value} onClick={() => setFilterTopic(value)} style={{ padding: '0.375rem 0.75rem', borderRadius: '9999px', border: filterTopic === value ? '2px solid #1e3a8a' : '2px solid #e2e8f0', background: filterTopic === value ? '#1e3a8a' : 'white', color: filterTopic === value ? 'white' : '#334155', cursor: 'pointer', fontWeight: 600, fontSize: '0.8125rem', whiteSpace: 'nowrap', flexShrink: 0 }}>
                                    {icon} {value === 'all' ? 'All' : value.charAt(0).toUpperCase() + value.slice(1)}
                                </button>
                            ))}
                        </div>
                        
                        {/* Advanced filters toggle */}
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <button onClick={() => setShowFilters(!showFilters)} style={{ background: 'none', border: 'none', color: '#1e3a8a', fontWeight: 600, cursor: 'pointer', fontSize: '0.8125rem', padding: 0 }}>
                                {showFilters ? '‚ñº Hide Filters' : '‚ñ∂ More Filters'} (Impact, Sort)
                            </button>
                            <span style={{ fontSize: '0.8125rem', color: '#64748b' }}>{filteredBills.length} bill{filteredBills.length !== 1 ? 's' : ''}</span>
                        </div>
                        
                        {showFilters && (
                            <div style={{ background: 'white', padding: '1rem', borderRadius: '0.75rem', marginBottom: '1rem', display: 'flex', gap: '1rem', flexWrap: 'wrap', alignItems: 'center' }}>
                                <div>
                                    <label style={{ fontSize: '0.75rem', fontWeight: 600, color: '#64748b', display: 'block', marginBottom: '0.25rem' }}>Impact Level</label>
                                    <select value={filterImpact} onChange={e => setFilterImpact(e.target.value)} style={{ padding: '0.5rem', borderRadius: '0.375rem', border: '2px solid #e2e8f0', fontSize: '0.875rem' }}>
                                        <option value="all">All Levels</option>
                                        <option value="high">üî¥ High</option>
                                        <option value="medium">üü° Medium</option>
                                        <option value="low">üîµ Low</option>
                                    </select>
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', fontWeight: 600, color: '#64748b', display: 'block', marginBottom: '0.25rem' }}>Sort By</label>
                                    <select value={sortBy} onChange={e => setSortBy(e.target.value)} style={{ padding: '0.5rem', borderRadius: '0.375rem', border: '2px solid #e2e8f0', fontSize: '0.875rem' }}>
                                        <option value="urgent">Most Urgent</option>
                                        <option value="recent">Newest First</option>
                                        <option value="oldest">Oldest First</option>
                                    </select>
                                </div>
                            </div>
                        )}
                        
                        {/* BILL LIST */}
                        {loading ? (
                            <div style={{ display: 'flex', justifyContent: 'center', padding: '4rem' }}><div className="spinner"></div></div>
                        ) : filteredBills.length === 0 ? (
                            <div style={{ textAlign: 'center', padding: '4rem 2rem', background: 'white', borderRadius: '1rem' }}>
                                <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üì≠</div>
                                <h3 style={{ fontWeight: 700, color: '#334155', marginBottom: '0.5rem' }}>
                                    {activeTab === 'watchlist' ? 'Your watchlist is empty' : 'No bills match your filters'}
                                </h3>
                                <p style={{ color: '#64748b' }}>
                                    {activeTab === 'watchlist' ? 'Tap the ‚≠ê on any bill to add it here.' : 'Try broadening your search or changing filters.'}
                                </p>
                            </div>
                        ) : (
                            <div>
                                {filteredBills.map(bill => (
                                    <BillCard key={bill.id} bill={bill} onViewDetails={setSelectedBill} watchlist={watchlist} toggleWatchlist={toggleWatchlist} />
                                ))}
                            </div>
                        )}
                        </>
                        )}
                    </main>
                    
                    {/* ===== FOOTER ===== */}
                    <footer style={{ backgroundColor: '#0f172a', color: 'white', padding: '1.5rem 1rem', marginTop: '2rem' }}>
                        <div style={{ maxWidth: '960px', margin: '0 auto', textAlign: 'center' }}>
                            <p style={{ marginBottom: '0.5rem', opacity: 0.9, fontSize: '0.9375rem' }}>Vigilance. Integrity. Community.</p>
                            <p style={{ fontSize: '0.8125rem', opacity: 0.6 }}>¬© 2026 Civic Rights Alert System. All bill data from official government APIs.</p>
                            <p style={{ fontSize: '0.75rem', opacity: 0.5, marginTop: '0.5rem' }}>‚ö†Ô∏è BETA ‚Äî Some features still in development</p>
                        </div>
                    </footer>
                    
                    {/* ===== SIDEBAR DRAWER (More Tools) ===== */}
                    {showDrawer && (
                        <>
                            <div className="sidebar-overlay" onClick={() => setShowDrawer(false)} />
                            <div className="sidebar-drawer">
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                                    <h2 style={{ fontSize: '1.25rem', fontWeight: 700, color: '#1e3a8a' }}>More Tools</h2>
                                    <button onClick={() => setShowDrawer(false)} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: '#64748b' }}>‚úï</button>
                                </div>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                    <button onClick={() => { setShowDrawer(false); setShowRepealTracker(true); }} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '1rem', border: '2px solid #e2e8f0', borderRadius: '0.75rem', background: 'white', cursor: 'pointer', textAlign: 'left', width: '100%' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üî•</span>
                                        <div><div style={{ fontWeight: 700, color: '#1e293b' }}>Repeal Tracker</div><div style={{ fontSize: '0.8125rem', color: '#64748b' }}>Bad laws we're fighting</div></div>
                                    </button>
                                    
                                    <button onClick={() => { setShowDrawer(false); setShowVictoryFeed(true); }} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '1rem', border: '2px solid #e2e8f0', borderRadius: '0.75rem', background: 'white', cursor: 'pointer', textAlign: 'left', width: '100%' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üìä</span>
                                        <div><div style={{ fontWeight: 700, color: '#1e293b' }}>Wins & Losses</div><div style={{ fontSize: '0.8125rem', color: '#64748b' }}>Recent bill outcomes</div></div>
                                    </button>
                                    
                                    <button onClick={() => { setShowDrawer(false); setShowStrategicGuide(true); }} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '1rem', border: '2px solid #fde68a', borderRadius: '0.75rem', background: '#fef3c7', cursor: 'pointer', textAlign: 'left', width: '100%' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üéØ</span>
                                        <div><div style={{ fontWeight: 700, color: '#92400e' }}>Strategic Guide</div><div style={{ fontSize: '0.8125rem', color: '#78350f' }}>How to stop a bad bill</div></div>
                                    </button>
                                    
                                    <button onClick={() => { setShowDrawer(false); alert('üöß Coming Soon!\n\nRepresentative lookup is in development.'); }} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '1rem', border: '2px solid #e2e8f0', borderRadius: '0.75rem', background: '#f8fafc', cursor: 'pointer', textAlign: 'left', width: '100%', opacity: 0.6 }}>
                                        <span style={{ fontSize: '1.5rem' }}>üèõÔ∏è</span>
                                        <div><div style={{ fontWeight: 700, color: '#64748b' }}>Your Representatives</div><div style={{ fontSize: '0.8125rem', color: '#94a3b8' }}>Coming soon</div></div>
                                    </button>
                                    
                                    <div style={{ borderTop: '2px solid #e2e8f0', margin: '0.5rem 0' }} />
                                    
                                    <button onClick={() => { setShowDrawer(false); setShowDonateModal(true); }} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '1rem', border: '2px solid #93c5fd', borderRadius: '0.75rem', background: '#eff6ff', cursor: 'pointer', textAlign: 'left', width: '100%' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üíô</span>
                                        <div><div style={{ fontWeight: 700, color: '#1e3a8a' }}>Support Us</div><div style={{ fontSize: '0.8125rem', color: '#334155' }}>Keep this free for everyone</div></div>
                                    </button>
                                    
                                    <button onClick={() => { setShowDrawer(false); setShowSubscribe(true); }} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '1rem', border: '2px solid #fde68a', borderRadius: '0.75rem', background: '#fefce8', cursor: 'pointer', textAlign: 'left', width: '100%' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üìß</span>
                                        <div><div style={{ fontWeight: 700, color: '#854d0e' }}>Get Alerts</div><div style={{ fontSize: '0.8125rem', color: '#92400e' }}>Email & SMS notifications</div></div>
                                    </button>
                                </div>
                                
                                <div style={{ marginTop: '2rem', padding: '1rem', backgroundColor: '#f1f5f9', borderRadius: '0.75rem' }}>
                                    <p style={{ fontSize: '0.8125rem', color: '#64748b', margin: 0, lineHeight: 1.5 }}>‚ö†Ô∏è BETA ‚Äî Bill tracking is functional with real data from official government sources. Some features are still being built.</p>
                                </div>
                            </div>
                        </>
                    )}
                    
                    {/* ===== ALL MODALS ===== */}
                    <SubscriptionModal isOpen={showSubscribe} onClose={() => setShowSubscribe(false)} />
                    <RepresentativesModal isOpen={showRepresentatives} onClose={() => setShowRepresentatives(false)} zipCode="85001" />
                    <RepealTrackerModal isOpen={showRepealTracker} onClose={() => setShowRepealTracker(false)} />
                    <VictoryDefeatFeed isOpen={showVictoryFeed} onClose={() => setShowVictoryFeed(false)} />
                    <BillDetailsModal bill={selectedBill} onClose={() => setSelectedBill(null)} />
                    <DonateModal isOpen={showDonateModal} onClose={() => setShowDonateModal(false)} />
                    <StrategicGuideModal isOpen={showStrategicGuide} onClose={() => setShowStrategicGuide(false)} />
                </div>
            );
        }

        ReactDOM.render(<CivicAlertApp />, document.getElementById('root'));
    </script>
</body>
</html>
